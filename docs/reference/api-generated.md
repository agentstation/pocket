<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pocket

```go
import "github.com/agentstation/pocket"
```

Package pocket provides a minimalist framework for building LLM workflows using composable nodes in a directed graph structure.

Key features:

- Small, composable interfaces
- Type\-safe operations with generics
- Built\-in concurrency patterns
- Functional options for configuration
- Zero external dependencies in core

Basic usage:

```
// Create a simple processor
greet := pocket.ProcessorFunc(func(ctx context.Context, input any) (any, error) {
	name := input.(string)
	return fmt.Sprintf("Hello, %s!", name), nil
})

// Create a node
node := pocket.NewNode[any, any]("greeter", greet)

// Create and run a graph
store := pocket.NewStore()
graph := pocket.NewGraph(node, store)
result, err := graph.Run(context.Background(), "World")
```

Building complex graphs:

```
// Use the builder API
builder := pocket.NewBuilder(store).
	Add(pocket.NewNode[any, any]("fetch", fetchData)).
	Add(pocket.NewNode[any, any]("process", processData)).
	Add(pocket.NewNode[any, any]("save", saveData)).
	Connect("fetch", "success", "process").
	Connect("process", "success", "save").
	Start("fetch")

graph, err := builder.Build()
```

Concurrent patterns:

```
// Fan-out processing
results, err := pocket.FanOut(ctx, processNode, store, items)

// Pipeline
result, err := pocket.Pipeline(ctx, nodes, store, input)

// Concurrent execution
results, err := pocket.RunConcurrent(ctx, nodes, store)
```

Type\-safe operations:

```
// Create a typed store
userStore := pocket.NewTypedStore[User](store)

// Type-safe get/set
user, exists, err := userStore.Get(ctx, "user:123")
err = userStore.Set(ctx, "user:123", newUser)
```

Package pocket provides a minimalist framework for building LLM workflows using composable nodes in a directed graph structure with Prep/Exec/Post lifecycle.

Type Safety: The framework provides three levels of type safety for workflow validation:

- Compile\-time: Generic node creation with NewNode\[In, Out\] enforces type consistency within nodes. The Go compiler checks function signatures when using the generic WithExec, WithPrep, etc. with typed nodes.

- Initialization\-time: ValidateFlow checks type compatibility across the entire workflow graph before execution begins. This catches type mismatches between connected nodes.

- Runtime: Type assertions in lifecycle functions ensure data integrity during execution. These are minimized when using typed nodes.

The goal is to verify type safety of the workflow graph as early as possible, catching errors before any workflow execution begins.

<details><summary>Example (Lifecycle)</summary>
<p>

Example\_lifecycle demonstrates the full Prep/Exec/Post lifecycle.

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/agentstation/pocket"
)

func main() {
	// Create a node that uses all three steps
	processor := pocket.NewNode[any, any]("processor",
		pocket.Steps{
			Prep: func(ctx context.Context, store pocket.StoreReader, input any) (any, error) {
				// Prepare: validate and transform input
				data := input.(map[string]int)
				if len(data) == 0 {
					return nil, fmt.Errorf("empty data")
				}
				return data, nil
			},
			Exec: func(ctx context.Context, data any) (any, error) {
				// Execute: calculate sum
				m := data.(map[string]int)
				sum := 0
				for _, v := range m {
					sum += v
				}
				return sum, nil
			},
			Post: func(ctx context.Context, store pocket.StoreWriter, input, data, sum any) (any, string, error) {
				// Post: decide routing based on result
				total := sum.(int)
				if total > 100 {
					return fmt.Sprintf("High total: %d", total), "high", nil
				}
				return fmt.Sprintf("Low total: %d", total), "low", nil
			},
		},
	)

	store := pocket.NewStore()
	graph := pocket.NewGraph(processor, store)

	result, err := graph.Run(context.Background(), map[string]int{
		"a": 10,
		"b": 20,
		"c": 30,
	})
	if err != nil {
		log.Fatal(err)
	}

	fmt.Println(result)
}
```

#### Output

```
Low total: 60
```

</p>
</details>

## Index

- [Variables](<#variables>)
- [func FanOut\[T any\]\(ctx context.Context, node Node, store Store, items \[\]T\) \(\[\]any, error\)](<#FanOut>)
- [func Pipeline\(ctx context.Context, nodes \[\]Node, store Store, input any\) \(any, error\)](<#Pipeline>)
- [func ResetDefaults\(\)](<#ResetDefaults>)
- [func RunConcurrent\(ctx context.Context, nodes \[\]Node, store Store, inputs \[\]any\) \(\[\]any, error\)](<#RunConcurrent>)
- [func SetDefaultExec\(fn ExecFunc\)](<#SetDefaultExec>)
- [func SetDefaultPost\(fn PostFunc\)](<#SetDefaultPost>)
- [func SetDefaultPrep\(fn PrepFunc\)](<#SetDefaultPrep>)
- [func SetDefaults\(opts ...Option\)](<#SetDefaults>)
- [func ValidateGraph\(start Node\) error](<#ValidateGraph>)
- [type Builder](<#Builder>)
  - [func NewBuilder\(store Store\) \*Builder](<#NewBuilder>)
  - [func \(b \*Builder\) Add\(node Node\) \*Builder](<#Builder.Add>)
  - [func \(b \*Builder\) Build\(\) \(\*Graph, error\)](<#Builder.Build>)
  - [func \(b \*Builder\) Connect\(from, action, to string\) \*Builder](<#Builder.Connect>)
  - [func \(b \*Builder\) Start\(name string\) \*Builder](<#Builder.Start>)
  - [func \(b \*Builder\) WithOptions\(opts ...GraphOption\) \*Builder](<#Builder.WithOptions>)
- [type ExecFunc](<#ExecFunc>)
- [type FallbackFunc](<#FallbackFunc>)
- [type FanIn](<#FanIn>)
  - [func NewFanIn\(combine func\(\[\]any\) \(any, error\), sources ...Node\) \*FanIn](<#NewFanIn>)
  - [func \(f \*FanIn\) Run\(ctx context.Context, store Store\) \(any, error\)](<#FanIn.Run>)
- [type Graph](<#Graph>)
  - [func NewGraph\(start Node, store Store, opts ...GraphOption\) \*Graph](<#NewGraph>)
  - [func \(g \*Graph\) AsNode\(name string\) Node](<#Graph.AsNode>)
  - [func \(g \*Graph\) Run\(ctx context.Context, input any\) \(output any, err error\)](<#Graph.Run>)
- [type GraphOption](<#GraphOption>)
  - [func WithLogger\(logger Logger\) GraphOption](<#WithLogger>)
  - [func WithTracer\(tracer Tracer\) GraphOption](<#WithTracer>)
- [type Logger](<#Logger>)
- [type Node](<#Node>)
  - [func Default\(n, next Node\) Node](<#Default>)
  - [func NewNode\[In, Out any\]\(name string, steps Steps, opts ...Option\) Node](<#NewNode>)
- [type Option](<#Option>)
  - [func WithErrorHandler\(handler func\(error\)\) Option](<#WithErrorHandler>)
  - [func WithExec\[In, Out any\]\(fn func\(ctx context.Context, input In\) \(Out, error\)\) Option](<#WithExec>)
  - [func WithOnComplete\(fn func\(ctx context.Context, store StoreWriter\)\) Option](<#WithOnComplete>)
  - [func WithOnFailure\(fn func\(ctx context.Context, store StoreWriter, err error\)\) Option](<#WithOnFailure>)
  - [func WithOnSuccess\[Out any\]\(fn func\(ctx context.Context, store StoreWriter, output Out\)\) Option](<#WithOnSuccess>)
  - [func WithPost\[In, Out any\]\(fn func\(ctx context.Context, store StoreWriter, input In, prepResult any, execResult Out\) \(Out, string, error\)\) Option](<#WithPost>)
  - [func WithPrep\[In any\]\(fn func\(ctx context.Context, store StoreReader, input In\) \(any, error\)\) Option](<#WithPrep>)
  - [func WithRetry\(maxRetries int, delay time.Duration\) Option](<#WithRetry>)
  - [func WithTimeout\(timeout time.Duration\) Option](<#WithTimeout>)
- [type PostFunc](<#PostFunc>)
- [type PrepFunc](<#PrepFunc>)
- [type Steps](<#Steps>)
- [type Store](<#Store>)
  - [func NewStore\(opts ...StoreOption\) Store](<#NewStore>)
- [type StoreOption](<#StoreOption>)
  - [func WithEvictionCallback\(fn func\(key string, value any\)\) StoreOption](<#WithEvictionCallback>)
  - [func WithMaxEntries\(maxEntries int\) StoreOption](<#WithMaxEntries>)
  - [func WithTTL\(ttl time.Duration\) StoreOption](<#WithTTL>)
- [type StoreReader](<#StoreReader>)
- [type StoreWriter](<#StoreWriter>)
- [type Tracer](<#Tracer>)
- [type TypedStore](<#TypedStore>)
  - [func NewTypedStore\[T any\]\(store Store\) TypedStore\[T\]](<#NewTypedStore>)


## Variables

<a name="ErrNoStartNode"></a>Common errors.

```go
var (
    // ErrNoStartNode is returned when a graph has no start node defined.
    ErrNoStartNode = errors.New("pocket: no start node defined")

    // ErrNodeNotFound is returned when a referenced node doesn't exist.
    ErrNodeNotFound = errors.New("pocket: node not found")

    // ErrInvalidInput is returned when input type doesn't match expected type.
    ErrInvalidInput = errors.New("pocket: invalid input type")
)
```

<a name="FanOut"></a>
## func [FanOut](<https://github.com/agentstation/pocket/blob/master/builder.go#L138>)

```go
func FanOut[T any](ctx context.Context, node Node, store Store, items []T) ([]any, error)
```

FanOut executes a node for each input item concurrently.

<details><summary>Example</summary>
<p>

ExampleFanOut demonstrates parallel processing of items.

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/agentstation/pocket"
)

func main() {
	// Create a processor that simulates work
	processor := pocket.NewNode[any, any]("process",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				num := input.(int)
				return num * num, nil
			},
		},
	)

	store := pocket.NewStore()
	items := []int{1, 2, 3, 4, 5}

	// Process items concurrently
	results, err := pocket.FanOut(context.Background(), processor, store, items)
	if err != nil {
		log.Fatal(err)
	}

	// Results maintain order
	for i, result := range results {
		fmt.Printf("%d -> %v\n", items[i], result)
	}
}
```

#### Output

```
1 -> 1
2 -> 4
3 -> 9
4 -> 16
5 -> 25
```

</p>
</details>

<a name="Pipeline"></a>
## func [Pipeline](<https://github.com/agentstation/pocket/blob/master/builder.go#L122>)

```go
func Pipeline(ctx context.Context, nodes []Node, store Store, input any) (any, error)
```

Pipeline executes nodes sequentially, passing output to input.

<details><summary>Example</summary>
<p>

ExamplePipeline demonstrates sequential processing.

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/agentstation/pocket"
)

func main() {
	store := pocket.NewStore()

	// Create a pipeline of transformations
	double := pocket.NewNode[any, any]("double",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return input.(int) * 2, nil
			},
		},
	)

	addTen := pocket.NewNode[any, any]("addTen",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return input.(int) + 10, nil
			},
		},
	)

	toString := pocket.NewNode[any, any]("toString",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return fmt.Sprintf("Result: %d", input.(int)), nil
			},
		},
	)

	nodes := []pocket.Node{double, addTen, toString}

	result, err := pocket.Pipeline(context.Background(), nodes, store, 5)
	if err != nil {
		log.Fatal(err)
	}

	fmt.Println(result)
}
```

#### Output

```
Result: 20
```

</p>
</details>

<a name="ResetDefaults"></a>
## func [ResetDefaults](<https://github.com/agentstation/pocket/blob/master/defaults.go#L124>)

```go
func ResetDefaults()
```

ResetDefaults resets all global defaults to their initial values.

<a name="RunConcurrent"></a>
## func [RunConcurrent](<https://github.com/agentstation/pocket/blob/master/builder.go#L76>)

```go
func RunConcurrent(ctx context.Context, nodes []Node, store Store, inputs []any) ([]any, error)
```

RunConcurrent executes multiple nodes concurrently.

<a name="SetDefaultExec"></a>
## func [SetDefaultExec](<https://github.com/agentstation/pocket/blob/master/defaults.go#L90>)

```go
func SetDefaultExec(fn ExecFunc)
```

SetDefaultExec sets the global default exec function.

<a name="SetDefaultPost"></a>
## func [SetDefaultPost](<https://github.com/agentstation/pocket/blob/master/defaults.go#L97>)

```go
func SetDefaultPost(fn PostFunc)
```

SetDefaultPost sets the global default post function.

<a name="SetDefaultPrep"></a>
## func [SetDefaultPrep](<https://github.com/agentstation/pocket/blob/master/defaults.go#L83>)

```go
func SetDefaultPrep(fn PrepFunc)
```

SetDefaultPrep sets the global default prep function.

<a name="SetDefaults"></a>
## func [SetDefaults](<https://github.com/agentstation/pocket/blob/master/defaults.go#L38>)

```go
func SetDefaults(opts ...Option)
```

SetDefaults configures global defaults for all nodes.

<a name="ValidateGraph"></a>
## func [ValidateGraph](<https://github.com/agentstation/pocket/blob/master/pocket.go#L690>)

```go
func ValidateGraph(start Node) error
```

ValidateGraph provides initialization\-time type safety by validating the entire workflow graph.

Type validation process:

1. Traverses the graph starting from the given node using depth\-first search
2. For each connection between nodes, verifies type compatibility: \- Source node's OutputType must be assignable to target node's InputType \- Interface satisfaction is checked \(e.g., concrete type implements interface\) \- Untyped nodes \(InputType/OutputType = nil\) are skipped but successors are validated
3. Returns detailed error messages identifying the exact type mismatch location

This is a critical part of the type safety system, catching errors before any workflow execution begins. It complements compile\-time checks by validating the connections between nodes.

Type compatibility rules:

- Exact type match: string \-\> string ✓
- Interface satisfaction: ConcreteType \-\> Interface \(if implements\) ✓
- Any type: any \-\> ConcreteType ✓ \(but loses compile\-time safety\)
- Assignability: Uses Go's reflect.Type.AssignableTo for compatibility

Example:

```
// Build your workflow
validator := NewNode[User, ValidationResult]("validator", ...)
processor := NewNode[ValidationResult, Response]("processor", ...)
validator.Connect("valid", processor)

// Validate before execution - catches type mismatches early
if err := ValidateGraph(validator); err != nil {
    // Error: "type mismatch: node 'validator' outputs ValidationResult
    //         but node 'wrongNode' expects User (via action 'valid')"
    log.Fatal(err)
}

// Safe to execute - types are verified
graph := NewGraph(validator, store)
result, err := graph.Run(ctx, user)
```

<a name="Builder"></a>
## type [Builder](<https://github.com/agentstation/pocket/blob/master/builder.go#L12-L17>)

Builder provides a fluent API for constructing graphs.

```go
type Builder struct {
    // contains filtered or unexported fields
}
```

<details><summary>Example</summary>
<p>

ExampleBuilder demonstrates the fluent builder API.

```go
store := pocket.NewStore()

// Define nodes with lifecycle
validate := pocket.NewNode[any, any]("validate",
	pocket.Steps{
		Prep: func(ctx context.Context, store pocket.StoreReader, input any) (any, error) {
			email, ok := input.(string)
			if !ok {
				return nil, fmt.Errorf("expected string")
			}
			return email, nil
		},
		Exec: func(ctx context.Context, email any) (any, error) {
			if !strings.Contains(email.(string), "@") {
				return nil, fmt.Errorf("invalid email")
			}
			return email, nil
		},
		Post: func(ctx context.Context, store pocket.StoreWriter, input, prep, result any) (any, string, error) {
			return result, defaultRoute, nil
		},
	},
)

normalize := pocket.NewNode[any, any]("normalize",
	pocket.Steps{
		Exec: func(ctx context.Context, input any) (any, error) {
			email := input.(string)
			return strings.ToLower(strings.TrimSpace(email)), nil
		},
	},
)

// Build the graph
graph, err := pocket.NewBuilder(store).
	Add(validate).
	Add(normalize).
	Connect("validate", "default", "normalize").
	Start("validate").
	Build()

if err != nil {
	log.Fatal(err)
}

result, err := graph.Run(context.Background(), "  USER@EXAMPLE.COM  ")
if err != nil {
	log.Fatal(err)
}

fmt.Println(result)
// Output: user@example.com
```

#### Output

```
user@example.com
```

</p>
</details>

<a name="NewBuilder"></a>
### func [NewBuilder](<https://github.com/agentstation/pocket/blob/master/builder.go#L20>)

```go
func NewBuilder(store Store) *Builder
```

NewBuilder creates a new graph builder.

<a name="Builder.Add"></a>
### func \(\*Builder\) [Add](<https://github.com/agentstation/pocket/blob/master/builder.go#L28>)

```go
func (b *Builder) Add(node Node) *Builder
```

Add registers a node in the graph.

<a name="Builder.Build"></a>
### func \(\*Builder\) [Build](<https://github.com/agentstation/pocket/blob/master/builder.go#L67>)

```go
func (b *Builder) Build() (*Graph, error)
```

Build creates the graph.

<a name="Builder.Connect"></a>
### func \(\*Builder\) [Connect](<https://github.com/agentstation/pocket/blob/master/builder.go#L45>)

```go
func (b *Builder) Connect(from, action, to string) *Builder
```

Connect creates a connection between nodes.

<a name="Builder.Start"></a>
### func \(\*Builder\) [Start](<https://github.com/agentstation/pocket/blob/master/builder.go#L37>)

```go
func (b *Builder) Start(name string) *Builder
```

Start sets the starting node.

<a name="Builder.WithOptions"></a>
### func \(\*Builder\) [WithOptions](<https://github.com/agentstation/pocket/blob/master/builder.go#L61>)

```go
func (b *Builder) WithOptions(opts ...GraphOption) *Builder
```

WithOptions adds graph options.

<a name="ExecFunc"></a>
## type [ExecFunc](<https://github.com/agentstation/pocket/blob/master/pocket.go#L46>)

ExecFunc performs the main processing logic without store access.

```go
type ExecFunc func(ctx context.Context, prepResult any) (execResult any, err error)
```

<a name="FallbackFunc"></a>
## type [FallbackFunc](<https://github.com/agentstation/pocket/blob/master/pocket.go#L54>)

FallbackFunc handles errors from the Exec step using the prepared data. It receives the prepResult \(like Exec\) and the error from the failed Exec. Like ExecFunc, it has no store access to maintain purity.

```go
type FallbackFunc func(ctx context.Context, prepResult any, execErr error) (fallbackResult any, err error)
```

<a name="FanIn"></a>
## type [FanIn](<https://github.com/agentstation/pocket/blob/master/builder.go#L170-L173>)

FanIn collects results from multiple sources.

```go
type FanIn struct {
    // contains filtered or unexported fields
}
```

<a name="NewFanIn"></a>
### func [NewFanIn](<https://github.com/agentstation/pocket/blob/master/builder.go#L176>)

```go
func NewFanIn(combine func([]any) (any, error), sources ...Node) *FanIn
```

NewFanIn creates a fan\-in pattern.

<a name="FanIn.Run"></a>
### func \(\*FanIn\) [Run](<https://github.com/agentstation/pocket/blob/master/builder.go#L184>)

```go
func (f *FanIn) Run(ctx context.Context, store Store) (any, error)
```

Run executes the fan\-in pattern.

<a name="Graph"></a>
## type [Graph](<https://github.com/agentstation/pocket/blob/master/pocket.go#L555-L557>)

Graph is the public handle to a graph for backward compatibility.

```go
type Graph struct {
    // contains filtered or unexported fields
}
```

<a name="NewGraph"></a>
### func [NewGraph](<https://github.com/agentstation/pocket/blob/master/pocket.go#L633>)

```go
func NewGraph(start Node, store Store, opts ...GraphOption) *Graph
```

NewGraph creates a new graph starting from the given node.

<a name="Graph.AsNode"></a>
### func \(\*Graph\) [AsNode](<https://github.com/agentstation/pocket/blob/master/pocket.go#L947>)

```go
func (g *Graph) AsNode(name string) Node
```

AsNode returns the graph as a Node interface. Since graph already implements Node, we just return it. This method exists for backward compatibility.

<a name="Graph.Run"></a>
### func \(\*Graph\) [Run](<https://github.com/agentstation/pocket/blob/master/pocket.go#L755>)

```go
func (g *Graph) Run(ctx context.Context, input any) (output any, err error)
```

Run executes the graph with the given input.

<a name="GraphOption"></a>
## type [GraphOption](<https://github.com/agentstation/pocket/blob/master/pocket.go#L566>)

GraphOption configures a Graph.

```go
type GraphOption func(*graphOptions)
```

<a name="WithLogger"></a>
### func [WithLogger](<https://github.com/agentstation/pocket/blob/master/pocket.go#L569>)

```go
func WithLogger(logger Logger) GraphOption
```

WithLogger adds logging to the graph.

<a name="WithTracer"></a>
### func [WithTracer](<https://github.com/agentstation/pocket/blob/master/pocket.go#L576>)

```go
func WithTracer(tracer Tracer) GraphOption
```

WithTracer adds distributed tracing.

<a name="Logger"></a>
## type [Logger](<https://github.com/agentstation/pocket/blob/master/pocket.go#L956-L960>)

Logger provides structured logging.

```go
type Logger interface {
    Debug(ctx context.Context, msg string, keysAndValues ...any)
    Info(ctx context.Context, msg string, keysAndValues ...any)
    Error(ctx context.Context, msg string, keysAndValues ...any)
}
```

<a name="Node"></a>
## type [Node](<https://github.com/agentstation/pocket/blob/master/pocket.go#L106-L124>)

Node is the core interface for all execution units in a workflow. Both simple nodes and graphs implement this interface.

```go
type Node interface {
    // Name returns the node's identifier.
    Name() string

    // Lifecycle methods for the Prep/Exec/Post pattern.
    Prep(ctx context.Context, store StoreReader, input any) (prepResult any, err error)
    Exec(ctx context.Context, prepResult any) (execResult any, err error)
    Post(ctx context.Context, store StoreWriter, input, prepResult, execResult any) (output any, next string, err error)

    // Connect adds a successor node for the given action.
    Connect(action string, next Node) Node

    // Successors returns all connected nodes.
    Successors() map[string]Node

    // Type information for validation (optional).
    InputType() reflect.Type
    OutputType() reflect.Type
}
```

<details><summary>Example</summary>
<p>

ExampleNode demonstrates using the Prep/Exec/Post lifecycle.

```go
// Create a node with lifecycle steps
uppercase := pocket.NewNode[any, any]("uppercase",
	pocket.Steps{
		Prep: func(ctx context.Context, store pocket.StoreReader, input any) (any, error) {
			// Validate input is a string
			text, ok := input.(string)
			if !ok {
				return nil, fmt.Errorf("expected string, got %T", input)
			}
			return text, nil
		},
		Exec: func(ctx context.Context, text any) (any, error) {
			// Transform to uppercase
			return strings.ToUpper(text.(string)), nil
		},
		Post: func(ctx context.Context, store pocket.StoreWriter, input, text, result any) (any, string, error) {
			// Return result and routing
			return result, doneRoute, nil
		},
	},
)

store := pocket.NewStore()
graph := pocket.NewGraph(uppercase, store)

result, err := graph.Run(context.Background(), "hello world")
if err != nil {
	log.Fatal(err)
}

fmt.Println(result)
// Output: HELLO WORLD
```

#### Output

```
HELLO WORLD
```

</p>
</details>

<details><summary>Example (Routing)</summary>
<p>

ExampleNode\_routing demonstrates conditional routing between nodes.

```go
package main

import (
	"context"
	"fmt"

	"github.com/agentstation/pocket"
)

func main() {
	store := pocket.NewStore()

	// Router node that checks input
	router := pocket.NewNode[any, any]("router",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return input, nil
			},
			Post: func(ctx context.Context, store pocket.StoreWriter, input, prep, result any) (any, string, error) {
				value := result.(int)
				if value > 100 {
					return result, "large", nil
				}
				return result, "small", nil
			},
		},
	)

	// Handler nodes
	largeHandler := pocket.NewNode[any, any]("large",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return fmt.Sprintf("Large number: %v", input), nil
			},
		},
	)

	smallHandler := pocket.NewNode[any, any]("small",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				return fmt.Sprintf("Small number: %v", input), nil
			},
		},
	)

	// Connect nodes
	router.Connect("large", largeHandler)
	router.Connect("small", smallHandler)

	// Run with different inputs
	graph := pocket.NewGraph(router, store)

	result1, _ := graph.Run(context.Background(), 50)
	result2, _ := graph.Run(context.Background(), 150)

	fmt.Println(result1)
	fmt.Println(result2)
}
```

#### Output

```
Small number: 50
Large number: 150
```

</p>
</details>

<a name="Default"></a>
### func [Default](<https://github.com/agentstation/pocket/blob/master/pocket.go#L541>)

```go
func Default(n, next Node) Node
```

Default is a helper function to connect to the default next node.

<a name="NewNode"></a>
### func [NewNode](<https://github.com/agentstation/pocket/blob/master/pocket.go#L490>)

```go
func NewNode[In, Out any](name string, steps Steps, opts ...Option) Node
```

NewNode creates a new node with optional compile\-time type safety.

Type parameters:

- In: The expected input type for this node \(use 'any' for dynamic typing\)
- Out: The output type this node produces \(use 'any' for dynamic typing\)

Parameters:

- name: The node's identifier
- steps: The lifecycle functions \(Prep, Exec, Post\) \- all fields are optional
- opts: Additional options like retry, timeout, error handlers, etc.

Type safety mechanism:

1. Compile\-time: When In/Out are not 'any', the node stores type information for validation. Using generic options like WithExec, WithPrep ensures function signatures match the declared types at compile time.

2. Initialization\-time: Call ValidateFlow on your start node to verify the entire workflow graph has compatible types between connected nodes.

3. Runtime: When using regular options \(WithExec, WithPrep\) with typed nodes, the framework automatically wraps functions to ensure type safety.

Examples:

```
// Typed node - enables full type checking across the workflow
validator := NewNode[User, ValidationResult]("validator",
    Steps{
        Exec: func(ctx context.Context, user any) (any, error) {
            // Type assertions handled by the framework
            return ValidationResult{Valid: true}, nil
        },
    },
    WithRetry(3, time.Second),
)

// Untyped node - no compile-time checks (explicit [any, any] encourages adding types)
processor := NewNode[any, any]("processor",
    Steps{
        Prep: prepFunc,
        Exec: execFunc,
        Post: postFunc,
    },
)
```

<a name="Option"></a>
## type [Option](<https://github.com/agentstation/pocket/blob/master/pocket.go#L170>)

Option configures a Node.

```go
type Option func(*nodeOptions)
```

<a name="WithErrorHandler"></a>
### func [WithErrorHandler](<https://github.com/agentstation/pocket/blob/master/pocket.go#L284>)

```go
func WithErrorHandler(handler func(error)) Option
```

WithErrorHandler sets a custom error handler.

<a name="WithExec"></a>
### func [WithExec](<https://github.com/agentstation/pocket/blob/master/pocket.go#L199>)

```go
func WithExec[In, Out any](fn func(ctx context.Context, input In) (Out, error)) Option
```

WithExec sets the execution function with type safety. The types In and Out should match the node's types when used with NewNode\[In, Out\]. For dynamic typing, use WithExec\[any, any\]. Exec functions do not have store access to enforce pure business logic.

<a name="WithOnComplete"></a>
### func [WithOnComplete](<https://github.com/agentstation/pocket/blob/master/pocket.go#L318>)

```go
func WithOnComplete(fn func(ctx context.Context, store StoreWriter)) Option
```

WithOnComplete sets a cleanup hook that always runs after execution. The store parameter provides full read\-write access for cleanup operations.

<a name="WithOnFailure"></a>
### func [WithOnFailure](<https://github.com/agentstation/pocket/blob/master/pocket.go#L310>)

```go
func WithOnFailure(fn func(ctx context.Context, store StoreWriter, err error)) Option
```

WithOnFailure sets a cleanup hook that runs after failed execution. The store parameter provides full read\-write access for cleanup operations.

<a name="WithOnSuccess"></a>
### func [WithOnSuccess](<https://github.com/agentstation/pocket/blob/master/pocket.go#L294>)

```go
func WithOnSuccess[Out any](fn func(ctx context.Context, store StoreWriter, output Out)) Option
```

WithOnSuccess sets a cleanup hook that runs after successful execution. The type Out should match the node's output type when used with NewNode\[In, Out\]. For dynamic typing, use WithOnSuccess\[any\]. The store parameter provides full read\-write access for cleanup operations.

<a name="WithPost"></a>
### func [WithPost](<https://github.com/agentstation/pocket/blob/master/pocket.go#L232>)

```go
func WithPost[In, Out any](fn func(ctx context.Context, store StoreWriter, input In, prepResult any, execResult Out) (Out, string, error)) Option
```

WithPost sets the post\-processing function with type safety. The types In and Out should match the node's types when used with NewNode\[In, Out\]. Post functions have access to all step results and determine routing. For dynamic typing, use WithPost\[any, any\]. The store parameter provides full read\-write access for state mutations.

<a name="WithPrep"></a>
### func [WithPrep](<https://github.com/agentstation/pocket/blob/master/pocket.go#L176>)

```go
func WithPrep[In any](fn func(ctx context.Context, store StoreReader, input In) (any, error)) Option
```

WithPrep sets the preparation function with type safety. The input type In should match the node's input type when used with NewNode\[In, Out\]. For dynamic typing, use WithPrep\[any\]. The store parameter provides read\-only access to enforce Prep step semantics.

<a name="WithRetry"></a>
### func [WithRetry](<https://github.com/agentstation/pocket/blob/master/pocket.go#L269>)

```go
func WithRetry(maxRetries int, delay time.Duration) Option
```

WithRetry configures retry behavior.

<details><summary>Example</summary>
<p>

ExampleWithRetry demonstrates retry configuration.

```go
package main

import (
	"context"
	"fmt"
	"log"
	"time"

	"github.com/agentstation/pocket"
)

func main() {
	attempts := 0

	// Create a node that fails twice before succeeding
	flaky := pocket.NewNode[any, any]("flaky",
		pocket.Steps{
			Exec: func(ctx context.Context, input any) (any, error) {
				attempts++
				if attempts < 3 {
					return nil, fmt.Errorf("temporary failure %d", attempts)
				}
				return "success", nil
			},
		},
		pocket.WithRetry(2, 10*time.Millisecond), // Retry up to 2 times
	)

	store := pocket.NewStore()
	graph := pocket.NewGraph(flaky, store)

	result, err := graph.Run(context.Background(), nil)
	if err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Result after %d attempts: %v\n", attempts, result)
}
```

#### Output

```
Result after 3 attempts: success
```

</p>
</details>

<a name="WithTimeout"></a>
### func [WithTimeout](<https://github.com/agentstation/pocket/blob/master/pocket.go#L277>)

```go
func WithTimeout(timeout time.Duration) Option
```

WithTimeout sets execution timeout.

<a name="PostFunc"></a>
## type [PostFunc](<https://github.com/agentstation/pocket/blob/master/pocket.go#L49>)

PostFunc processes results and determines routing with full store access.

```go
type PostFunc func(ctx context.Context, store StoreWriter, input, prepResult, execResult any) (output any, next string, err error)
```

<a name="PrepFunc"></a>
## type [PrepFunc](<https://github.com/agentstation/pocket/blob/master/pocket.go#L43>)

PrepFunc prepares data before execution with read\-only store access.

```go
type PrepFunc func(ctx context.Context, store StoreReader, input any) (prepResult any, err error)
```

<a name="Steps"></a>
## type [Steps](<https://github.com/agentstation/pocket/blob/master/pocket.go#L58-L71>)

Steps groups the lifecycle functions for a node. All fields are optional \- if not provided, default implementations will be used.

```go
type Steps struct {
    // Prep prepares data before execution with read-only store access.
    Prep PrepFunc

    // Exec performs the main processing logic without store access.
    Exec ExecFunc

    // Fallback handles Exec errors with the prepared data.
    // Like Exec, it receives prepResult and has no store access.
    Fallback FallbackFunc

    // Post processes results and determines routing with full store access.
    Post PostFunc
}
```

<a name="Store"></a>
## type [Store](<https://github.com/agentstation/pocket/blob/master/pocket.go#L90-L102>)

Store provides thread\-safe storage for shared state.

```go
type Store interface {
    // Get retrieves a value by key.
    Get(ctx context.Context, key string) (value any, exists bool)

    // Set stores a value with the given key.
    Set(ctx context.Context, key string, value any) error

    // Delete removes a key from the store.
    Delete(ctx context.Context, key string) error

    // Scope returns a new store with the given prefix.
    Scope(prefix string) Store
}
```

<a name="NewStore"></a>
### func [NewStore](<https://github.com/agentstation/pocket/blob/master/store.go#L63>)

```go
func NewStore(opts ...StoreOption) Store
```

NewStore creates a new thread\-safe store with optional configuration.

<a name="StoreOption"></a>
## type [StoreOption](<https://github.com/agentstation/pocket/blob/master/store.go#L12>)

StoreOption configures a store.

```go
type StoreOption func(*storeConfig)
```

<a name="WithEvictionCallback"></a>
### func [WithEvictionCallback](<https://github.com/agentstation/pocket/blob/master/store.go#L38>)

```go
func WithEvictionCallback(fn func(key string, value any)) StoreOption
```

WithEvictionCallback sets a callback for when entries are evicted.

<a name="WithMaxEntries"></a>
### func [WithMaxEntries](<https://github.com/agentstation/pocket/blob/master/store.go#L23>)

```go
func WithMaxEntries(maxEntries int) StoreOption
```

WithMaxEntries sets the maximum number of entries in the store. When exceeded, the least recently used entry is evicted.

<a name="WithTTL"></a>
### func [WithTTL](<https://github.com/agentstation/pocket/blob/master/store.go#L31>)

```go
func WithTTL(ttl time.Duration) StoreOption
```

WithTTL sets the time\-to\-live for entries. Entries older than the TTL are automatically removed.

<a name="StoreReader"></a>
## type [StoreReader](<https://github.com/agentstation/pocket/blob/master/pocket.go#L75-L81>)

StoreReader provides read\-only access to the store. Used in the Prep step to enforce read\-only semantics.

```go
type StoreReader interface {
    // Get retrieves a value by key.
    Get(ctx context.Context, key string) (value any, exists bool)

    // Scope returns a new store with the given prefix.
    Scope(prefix string) Store
}
```

<a name="StoreWriter"></a>
## type [StoreWriter](<https://github.com/agentstation/pocket/blob/master/pocket.go#L85-L87>)

StoreWriter provides full read\-write access to the store. Used in the Post step for state mutations.

```go
type StoreWriter interface {
    Store
}
```

<a name="Tracer"></a>
## type [Tracer](<https://github.com/agentstation/pocket/blob/master/pocket.go#L963-L965>)

Tracer provides distributed tracing capabilities.

```go
type Tracer interface {
    StartSpan(ctx context.Context, name string) (context.Context, func())
}
```

<a name="TypedStore"></a>
## type [TypedStore](<https://github.com/agentstation/pocket/blob/master/store.go#L195-L199>)

TypedStore provides type\-safe storage operations.

```go
type TypedStore[T any] interface {
    Get(ctx context.Context, key string) (T, bool, error)
    Set(ctx context.Context, key string, value T) error
    Delete(ctx context.Context, key string) error
}
```

<details><summary>Example</summary>
<p>

ExampleTypedStore demonstrates type\-safe storage.

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/agentstation/pocket"
)

func main() {
	type User struct {
		ID   string
		Name string
	}

	// Create a typed store
	store := pocket.NewStore()
	userStore := pocket.NewTypedStore[User](store)

	ctx := context.Background()

	// Store a user
	user := User{ID: "123", Name: "Alice"}
	err := userStore.Set(ctx, "user:123", user)
	if err != nil {
		log.Fatal(err)
	}

	// Retrieve with type safety
	retrieved, exists, err := userStore.Get(ctx, "user:123")
	if err != nil {
		log.Fatal(err)
	}

	if exists {
		fmt.Printf("Found user: %+v\n", retrieved)
	}
}
```

#### Output

```
Found user: {ID:123 Name:Alice}
```

</p>
</details>

<a name="NewTypedStore"></a>
### func [NewTypedStore](<https://github.com/agentstation/pocket/blob/master/store.go#L202>)

```go
func NewTypedStore[T any](store Store) TypedStore[T]
```

NewTypedStore creates a type\-safe wrapper around a Store.

# batch

```go
import "github.com/agentstation/pocket/batch"
```

Package batch provides generic batch processing capabilities for pocket workflows.

## Index

- [func Filter\[T any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), predicate func\(context.Context, T\) \(bool, error\), opts ...Option\) pocket.Node](<#Filter>)
- [func ForEach\[T any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), process func\(context.Context, T\) error, opts ...Option\) pocket.Node](<#ForEach>)
- [func MapReduce\[T, R any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), mapper func\(context.Context, T\) \(R, error\), reducer func\(context.Context, \[\]R\) \(any, error\), opts ...Option\) pocket.Node](<#MapReduce>)
- [type Option](<#Option>)
  - [func WithConcurrency\(n int\) Option](<#WithConcurrency>)
  - [func WithOrdered\(\) Option](<#WithOrdered>)
- [type Processor](<#Processor>)
  - [func NewProcessor\[T, R any\]\(extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), transform func\(context.Context, T\) \(R, error\), reduce func\(context.Context, \[\]R\) \(any, error\), opts ...Option\) \*Processor\[T, R\]](<#NewProcessor>)
  - [func \(p \*Processor\[T, R\]\) ToNode\(name string\) pocket.Node](<#Processor[T, R].ToNode>)


<a name="Filter"></a>
## func [Filter](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L217-L222>)

```go
func Filter[T any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), predicate func(context.Context, T) (bool, error), opts ...Option) pocket.Node
```

Filter creates a batch processor that filters items.

<a name="ForEach"></a>
## func [ForEach](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L198-L203>)

```go
func ForEach[T any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), process func(context.Context, T) error, opts ...Option) pocket.Node
```

ForEach creates a batch processor that doesn't aggregate results.

<a name="MapReduce"></a>
## func [MapReduce](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L186-L192>)

```go
func MapReduce[T, R any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), mapper func(context.Context, T) (R, error), reducer func(context.Context, []R) (any, error), opts ...Option) pocket.Node
```

MapReduce creates a map\-reduce batch processor as a Node.

<a name="Option"></a>
## type [Option](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L31>)

Option configures a batch processor.

```go
type Option func(*options)
```

<a name="WithConcurrency"></a>
### func [WithConcurrency](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L39>)

```go
func WithConcurrency(n int) Option
```

WithConcurrency sets the maximum concurrent workers.

<a name="WithOrdered"></a>
### func [WithOrdered](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L46>)

```go
func WithOrdered() Option
```

WithOrdered ensures results maintain input order.

<a name="Processor"></a>
## type [Processor](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L15-L28>)

Processor processes a batch of items of type T.

```go
type Processor[T, R any] struct {
    // Extract retrieves items to process.
    Extract func(ctx context.Context, store pocket.StoreReader) ([]T, error)

    // Transform processes a single item.
    Transform func(ctx context.Context, item T) (R, error)

    // Reduce combines results into a final output.
    Reduce func(ctx context.Context, results []R) (any, error)
    // contains filtered or unexported fields
}
```

<a name="NewProcessor"></a>
### func [NewProcessor](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L53-L58>)

```go
func NewProcessor[T, R any](extract func(context.Context, pocket.StoreReader) ([]T, error), transform func(context.Context, T) (R, error), reduce func(context.Context, []R) (any, error), opts ...Option) *Processor[T, R]
```

NewProcessor creates a new batch processor.

<a name="Processor[T, R].ToNode"></a>
### func \(\*Processor\[T, R\]\) [ToNode](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L83>)

```go
func (p *Processor[T, R]) ToNode(name string) pocket.Node
```

ToNode converts the batch processor into a pocket Node.

# cache

```go
import "github.com/agentstation/pocket/cache"
```

Package cache provides computation memoization for expensive node operations, with LRU and TTL\-based eviction strategies.

## Index

- [func CacheMiddleware\(cache Cache, keyFunc func\(any\) string, ttl time.Duration\) func\(pocket.Node\) pocket.Node](<#CacheMiddleware>)
- [func CompositeKeyFunc\(funcs ...func\(any\) string\) func\(any\) string](<#CompositeKeyFunc>)
- [func HashKeyFunc\(prefix string\) func\(any\) string](<#HashKeyFunc>)
- [type Cache](<#Cache>)
- [type CacheStats](<#CacheStats>)
- [type CachedNode](<#CachedNode>)
  - [func NewCachedNode\(node pocket.Node, cache Cache, keyFunc func\(any\) string, ttl time.Duration\) \*CachedNode](<#NewCachedNode>)
  - [func \(n \*CachedNode\) Connect\(action string, next pocket.Node\) pocket.Node](<#CachedNode.Connect>)
  - [func \(n \*CachedNode\) Exec\(ctx context.Context, prepResult any\) \(any, error\)](<#CachedNode.Exec>)
  - [func \(n \*CachedNode\) InputType\(\) reflect.Type](<#CachedNode.InputType>)
  - [func \(n \*CachedNode\) Name\(\) string](<#CachedNode.Name>)
  - [func \(n \*CachedNode\) OutputType\(\) reflect.Type](<#CachedNode.OutputType>)
  - [func \(n \*CachedNode\) Post\(ctx context.Context, store pocket.StoreWriter, input, prepResult, execResult any\) \(output any, next string, err error\)](<#CachedNode.Post>)
  - [func \(n \*CachedNode\) Prep\(ctx context.Context, store pocket.StoreReader, input any\) \(any, error\)](<#CachedNode.Prep>)
  - [func \(n \*CachedNode\) Successors\(\) map\[string\]pocket.Node](<#CachedNode.Successors>)
- [type LRUCache](<#LRUCache>)
  - [func NewLRUCache\(maxSize int\) \*LRUCache](<#NewLRUCache>)
  - [func \(c \*LRUCache\) Clear\(\)](<#LRUCache.Clear>)
  - [func \(c \*LRUCache\) Delete\(key string\)](<#LRUCache.Delete>)
  - [func \(c \*LRUCache\) Get\(key string\) \(any, bool\)](<#LRUCache.Get>)
  - [func \(c \*LRUCache\) Set\(key string, value any, ttl time.Duration\)](<#LRUCache.Set>)
  - [func \(c \*LRUCache\) Stats\(\) CacheStats](<#LRUCache.Stats>)
- [type TTLCache](<#TTLCache>)
  - [func NewTTLCache\(\) \*TTLCache](<#NewTTLCache>)
  - [func \(c \*TTLCache\) Clear\(\)](<#TTLCache.Clear>)
  - [func \(c \*TTLCache\) Delete\(key string\)](<#TTLCache.Delete>)
  - [func \(c \*TTLCache\) Get\(key string\) \(any, bool\)](<#TTLCache.Get>)
  - [func \(c \*TTLCache\) Set\(key string, value any, ttl time.Duration\)](<#TTLCache.Set>)
  - [func \(c \*TTLCache\) Stats\(\) CacheStats](<#TTLCache.Stats>)


<a name="CacheMiddleware"></a>
## func [CacheMiddleware](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L259>)

```go
func CacheMiddleware(cache Cache, keyFunc func(any) string, ttl time.Duration) func(pocket.Node) pocket.Node
```

CacheMiddleware creates a caching middleware for nodes.

<a name="CompositeKeyFunc"></a>
## func [CompositeKeyFunc](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L276>)

```go
func CompositeKeyFunc(funcs ...func(any) string) func(any) string
```

CompositeKeyFunc combines multiple key functions.

<a name="HashKeyFunc"></a>
## func [HashKeyFunc](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L267>)

```go
func HashKeyFunc(prefix string) func(any) string
```

HashKeyFunc creates a key function that hashes the input.

<a name="Cache"></a>
## type [Cache](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L18-L24>)

Cache provides result caching for nodes.

```go
type Cache interface {
    Get(key string) (value any, exists bool)
    Set(key string, value any, ttl time.Duration)
    Delete(key string)
    Clear()
    Stats() CacheStats
}
```

<a name="CacheStats"></a>
## type [CacheStats](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L27-L35>)

CacheStats contains cache statistics.

```go
type CacheStats struct {
    Hits      int64
    Misses    int64
    Sets      int64
    Deletes   int64
    Evictions int64
    Size      int
    MaxSize   int
}
```

<a name="CachedNode"></a>
## type [CachedNode](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L187-L192>)

CachedNode wraps a node with caching.

```go
type CachedNode struct {
    Node pocket.Node
    // contains filtered or unexported fields
}
```

<a name="NewCachedNode"></a>
### func [NewCachedNode](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L195>)

```go
func NewCachedNode(node pocket.Node, cache Cache, keyFunc func(any) string, ttl time.Duration) *CachedNode
```

NewCachedNode creates a node with caching.

<a name="CachedNode.Connect"></a>
### func \(\*CachedNode\) [Connect](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L238>)

```go
func (n *CachedNode) Connect(action string, next pocket.Node) pocket.Node
```

Connect implements the Node interface.

<a name="CachedNode.Exec"></a>
### func \(\*CachedNode\) [Exec](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L215>)

```go
func (n *CachedNode) Exec(ctx context.Context, prepResult any) (any, error)
```

Exec implements the Node interface with caching.

<a name="CachedNode.InputType"></a>
### func \(\*CachedNode\) [InputType](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L249>)

```go
func (n *CachedNode) InputType() reflect.Type
```

InputType implements the Node interface.

<a name="CachedNode.Name"></a>
### func \(\*CachedNode\) [Name](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L205>)

```go
func (n *CachedNode) Name() string
```

Name returns the node's name.

<a name="CachedNode.OutputType"></a>
### func \(\*CachedNode\) [OutputType](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L254>)

```go
func (n *CachedNode) OutputType() reflect.Type
```

OutputType implements the Node interface.

<a name="CachedNode.Post"></a>
### func \(\*CachedNode\) [Post](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L233>)

```go
func (n *CachedNode) Post(ctx context.Context, store pocket.StoreWriter, input, prepResult, execResult any) (output any, next string, err error)
```

Post implements the Node interface.

<a name="CachedNode.Prep"></a>
### func \(\*CachedNode\) [Prep](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L210>)

```go
func (n *CachedNode) Prep(ctx context.Context, store pocket.StoreReader, input any) (any, error)
```

Prep implements the Node interface.

<a name="CachedNode.Successors"></a>
### func \(\*CachedNode\) [Successors](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L244>)

```go
func (n *CachedNode) Successors() map[string]pocket.Node
```

Successors implements the Node interface.

<a name="LRUCache"></a>
## type [LRUCache](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L38-L45>)

LRUCache implements an LRU cache with TTL support.

```go
type LRUCache struct {
    // contains filtered or unexported fields
}
```

<a name="NewLRUCache"></a>
### func [NewLRUCache](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L55>)

```go
func NewLRUCache(maxSize int) *LRUCache
```

NewLRUCache creates a new LRU cache.

<a name="LRUCache.Clear"></a>
### func \(\*LRUCache\) [Clear](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L139>)

```go
func (c *LRUCache) Clear()
```

Clear removes all entries from the cache.

<a name="LRUCache.Delete"></a>
### func \(\*LRUCache\) [Delete](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L128>)

```go
func (c *LRUCache) Delete(key string)
```

Delete removes a key from the cache.

<a name="LRUCache.Get"></a>
### func \(\*LRUCache\) [Get](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L72>)

```go
func (c *LRUCache) Get(key string) (any, bool)
```

Get retrieves a value from the cache.

<a name="LRUCache.Set"></a>
### func \(\*LRUCache\) [Set](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L96>)

```go
func (c *LRUCache) Set(key string, value any, ttl time.Duration)
```

Set stores a value in the cache.

<a name="LRUCache.Stats"></a>
### func \(\*LRUCache\) [Stats](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L150>)

```go
func (c *LRUCache) Stats() CacheStats
```

Stats returns cache statistics.

<a name="TTLCache"></a>
## type [TTLCache](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L287-L291>)

TTLCache implements a simple TTL\-only cache.

```go
type TTLCache struct {
    // contains filtered or unexported fields
}
```

<a name="NewTTLCache"></a>
### func [NewTTLCache](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L299>)

```go
func NewTTLCache() *TTLCache
```

NewTTLCache creates a new TTL cache.

<a name="TTLCache.Clear"></a>
### func \(\*TTLCache\) [Clear](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L356>)

```go
func (c *TTLCache) Clear()
```

Clear removes all entries.

<a name="TTLCache.Delete"></a>
### func \(\*TTLCache\) [Delete](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L344>)

```go
func (c *TTLCache) Delete(key string)
```

Delete removes a key from the cache.

<a name="TTLCache.Get"></a>
### func \(\*TTLCache\) [Get](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L311>)

```go
func (c *TTLCache) Get(key string) (any, bool)
```

Get retrieves a value from the cache.

<a name="TTLCache.Set"></a>
### func \(\*TTLCache\) [Set](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L331>)

```go
func (c *TTLCache) Set(key string, value any, ttl time.Duration)
```

Set stores a value in the cache.

<a name="TTLCache.Stats"></a>
### func \(\*TTLCache\) [Stats](<https://github.com/agentstation/pocket/blob/master/cache/cache.go#L365>)

```go
func (c *TTLCache) Stats() CacheStats
```

Stats returns cache statistics.

# compose

```go
import "github.com/agentstation/pocket/compose"
```

Package compose provides advanced graph composition utilities for building complex workflows from simpler sub\-graphs.

## Index

- [func AsNodeWithStore\(graph \*pocket.Graph, name, inputKey, outputKey string\) pocket.Node](<#AsNodeWithStore>)
- [func ParallelGraphs\(ctx context.Context, store pocket.Store, graphs ...\*pocket.Graph\) \(\[\]any, error\)](<#ParallelGraphs>)
- [func SequentialGraphs\(name string, store pocket.Store, graphs ...\*pocket.Graph\) \(\*pocket.Graph, error\)](<#SequentialGraphs>)
- [type Builder](<#Builder>)
  - [func NewBuilder\(name string, store pocket.Store\) \*Builder](<#NewBuilder>)
  - [func \(b \*Builder\) AddGraph\(name string, graph \*pocket.Graph\) \*Builder](<#Builder.AddGraph>)
  - [func \(b \*Builder\) AddGraphWithStore\(name string, graph \*pocket.Graph, inputKey, outputKey string\) \*Builder](<#Builder.AddGraphWithStore>)
  - [func \(b \*Builder\) Build\(\) \(\*pocket.Graph, error\)](<#Builder.Build>)
  - [func \(b \*Builder\) Connect\(from, action, to string\) \*Builder](<#Builder.Connect>)


<a name="AsNodeWithStore"></a>
## func [AsNodeWithStore](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L14>)

```go
func AsNodeWithStore(graph *pocket.Graph, name, inputKey, outputKey string) pocket.Node
```

AsNodeWithStore converts a Graph into a Node with specific store keys for input and output, enabling proper state isolation between composed graphs.

<a name="ParallelGraphs"></a>
## func [ParallelGraphs](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L73>)

```go
func ParallelGraphs(ctx context.Context, store pocket.Store, graphs ...*pocket.Graph) ([]any, error)
```

ParallelGraphs executes multiple graphs in parallel and returns their results. Results are returned in the same order as the input graphs.

<a name="SequentialGraphs"></a>
## func [SequentialGraphs](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L50>)

```go
func SequentialGraphs(name string, store pocket.Store, graphs ...*pocket.Graph) (*pocket.Graph, error)
```

SequentialGraphs creates a new graph that executes multiple graphs in sequence. Each graph is wrapped as a node and connected in order.

<a name="Builder"></a>
## type [Builder](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L97-L103>)

Builder provides a fluent API for building nested graph structures.

```go
type Builder struct {
    // contains filtered or unexported fields
}
```

<a name="NewBuilder"></a>
### func [NewBuilder](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L106>)

```go
func NewBuilder(name string, store pocket.Store) *Builder
```

NewBuilder creates a new builder for composing graphs.

<a name="Builder.AddGraph"></a>
### func \(\*Builder\) [AddGraph](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L115>)

```go
func (b *Builder) AddGraph(name string, graph *pocket.Graph) *Builder
```

AddGraph adds a graph as a node in the composition.

<a name="Builder.AddGraphWithStore"></a>
### func \(\*Builder\) [AddGraphWithStore](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L125>)

```go
func (b *Builder) AddGraphWithStore(name string, graph *pocket.Graph, inputKey, outputKey string) *Builder
```

AddGraphWithStore adds a graph with specific store keys for input/output isolation.

<a name="Builder.Build"></a>
### func \(\*Builder\) [Build](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L161>)

```go
func (b *Builder) Build() (*pocket.Graph, error)
```

Build creates the final composed graph.

<a name="Builder.Connect"></a>
### func \(\*Builder\) [Connect](<https://github.com/agentstation/pocket/blob/master/compose/compose.go#L135>)

```go
func (b *Builder) Connect(from, action, to string) *Builder
```

Connect connects two graphs by name with a specific action.

# fallback

```go
import "github.com/agentstation/pocket/fallback"
```

Package fallback provides circuit breaker pattern implementation.

Package fallback provides fallback mechanisms for pocket workflows including circuit breakers and sophisticated fallback chains.

## Index

- [func ToCircuitBreakerNode\(name string, primary pocket.ExecFunc, fallback Handler, opts ...CircuitOption\) pocket.Node](<#ToCircuitBreakerNode>)
- [func ToNode\(policy Policy\) pocket.Node](<#ToNode>)
- [type AdaptiveChain](<#AdaptiveChain>)
  - [func NewAdaptiveChain\(name string, learningRate float64\) \*AdaptiveChain](<#NewAdaptiveChain>)
  - [func \(a \*AdaptiveChain\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#AdaptiveChain.Execute>)
- [type CachedFallbackPolicy](<#CachedFallbackPolicy>)
  - [func NewCachedFallbackPolicy\(name string, primary pocket.ExecFunc, cacheKey func\(any\) string\) \*CachedFallbackPolicy](<#NewCachedFallbackPolicy>)
  - [func \(p \*CachedFallbackPolicy\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#CachedFallbackPolicy.Execute>)
  - [func \(p \*CachedFallbackPolicy\) Name\(\) string](<#CachedFallbackPolicy.Name>)
  - [func \(p \*CachedFallbackPolicy\) WithStaleOK\(ok bool\) \*CachedFallbackPolicy](<#CachedFallbackPolicy.WithStaleOK>)
  - [func \(p \*CachedFallbackPolicy\) WithTTL\(ttl time.Duration\) \*CachedFallbackPolicy](<#CachedFallbackPolicy.WithTTL>)
- [type Chain](<#Chain>)
  - [func NewChain\(name string\) \*Chain](<#NewChain>)
  - [func \(c \*Chain\) AddLink\(link Link\) \*Chain](<#Chain.AddLink>)
  - [func \(c \*Chain\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#Chain.Execute>)
  - [func \(c \*Chain\) GetMetrics\(\) MetricsSnapshot](<#Chain.GetMetrics>)
  - [func \(c \*Chain\) WithStrategy\(strategy Strategy\) \*Chain](<#Chain.WithStrategy>)
- [type ChainOption](<#ChainOption>)
  - [func CollectErrors\(\) ChainOption](<#CollectErrors>)
  - [func StopOnFirstSuccess\(\) ChainOption](<#StopOnFirstSuccess>)
  - [func WithTimeout\(d time.Duration\) ChainOption](<#WithTimeout>)
- [type ChainPolicy](<#ChainPolicy>)
  - [func NewChainPolicy\(name string, handlers \[\]pocket.ExecFunc, opts ...ChainOption\) \*ChainPolicy](<#NewChainPolicy>)
  - [func \(p \*ChainPolicy\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#ChainPolicy.Execute>)
  - [func \(p \*ChainPolicy\) Name\(\) string](<#ChainPolicy.Name>)
- [type CircuitBreaker](<#CircuitBreaker>)
  - [func NewCircuitBreaker\(name string, opts ...CircuitOption\) \*CircuitBreaker](<#NewCircuitBreaker>)
  - [func \(cb \*CircuitBreaker\) Execute\(ctx context.Context, store pocket.Store, fn pocket.ExecFunc, input any\) \(any, error\)](<#CircuitBreaker.Execute>)
  - [func \(cb \*CircuitBreaker\) GetMetrics\(\) CircuitMetrics](<#CircuitBreaker.GetMetrics>)
  - [func \(cb \*CircuitBreaker\) GetState\(\) CircuitState](<#CircuitBreaker.GetState>)
- [type CircuitBreakerGroup](<#CircuitBreakerGroup>)
  - [func NewCircuitBreakerGroup\(\) \*CircuitBreakerGroup](<#NewCircuitBreakerGroup>)
  - [func \(g \*CircuitBreakerGroup\) Get\(name string, opts ...CircuitOption\) \*CircuitBreaker](<#CircuitBreakerGroup.Get>)
  - [func \(g \*CircuitBreakerGroup\) GetAllMetrics\(\) \[\]CircuitMetrics](<#CircuitBreakerGroup.GetAllMetrics>)
  - [func \(g \*CircuitBreakerGroup\) Reset\(\)](<#CircuitBreakerGroup.Reset>)
- [type CircuitBreakerPolicy](<#CircuitBreakerPolicy>)
  - [func NewCircuitBreakerPolicy\(name string, primary pocket.ExecFunc, fallback Handler, opts ...CircuitOption\) \*CircuitBreakerPolicy](<#NewCircuitBreakerPolicy>)
  - [func \(p \*CircuitBreakerPolicy\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#CircuitBreakerPolicy.Execute>)
  - [func \(p \*CircuitBreakerPolicy\) Name\(\) string](<#CircuitBreakerPolicy.Name>)
- [type CircuitMetrics](<#CircuitMetrics>)
- [type CircuitOption](<#CircuitOption>)
  - [func WithHalfOpenRequests\(n int\) CircuitOption](<#WithHalfOpenRequests>)
  - [func WithMaxFailures\(n int\) CircuitOption](<#WithMaxFailures>)
  - [func WithResetTimeout\(d time.Duration\) CircuitOption](<#WithResetTimeout>)
  - [func WithStateChangeCallback\(fn func\(from, to CircuitState\)\) CircuitOption](<#WithStateChangeCallback>)
- [type CircuitState](<#CircuitState>)
  - [func \(s CircuitState\) String\(\) string](<#CircuitState.String>)
- [type Handler](<#Handler>)
- [type Link](<#Link>)
- [type LinkStats](<#LinkStats>)
- [type Metrics](<#Metrics>)
- [type MetricsSnapshot](<#MetricsSnapshot>)
- [type ParallelStrategy](<#ParallelStrategy>)
  - [func NewParallelStrategy\(timeout time.Duration\) \*ParallelStrategy](<#NewParallelStrategy>)
  - [func \(s \*ParallelStrategy\) Execute\(ctx context.Context, chain \*Chain, store pocket.Store, input any\) \(any, error\)](<#ParallelStrategy.Execute>)
- [type Policy](<#Policy>)
- [type PolicyBuilder](<#PolicyBuilder>)
  - [func NewPolicyBuilder\(name string\) \*PolicyBuilder](<#NewPolicyBuilder>)
  - [func \(b \*PolicyBuilder\) Add\(policy Policy\) \*PolicyBuilder](<#PolicyBuilder.Add>)
  - [func \(b \*PolicyBuilder\) Build\(\) Policy](<#PolicyBuilder.Build>)
- [type SequentialStrategy](<#SequentialStrategy>)
  - [func \(s \*SequentialStrategy\) Execute\(ctx context.Context, chain \*Chain, store pocket.Store, input any\) \(any, error\)](<#SequentialStrategy.Execute>)
- [type SimplePolicy](<#SimplePolicy>)
  - [func NewSimplePolicy\(name string, primary pocket.ExecFunc, fallback Handler\) \*SimplePolicy](<#NewSimplePolicy>)
  - [func \(p \*SimplePolicy\) Execute\(ctx context.Context, store pocket.Store, input any\) \(any, error\)](<#SimplePolicy.Execute>)
  - [func \(p \*SimplePolicy\) Name\(\) string](<#SimplePolicy.Name>)
- [type Strategy](<#Strategy>)
- [type WeightedRandomStrategy](<#WeightedRandomStrategy>)
  - [func NewWeightedRandomStrategy\(maxAttempts int\) \*WeightedRandomStrategy](<#NewWeightedRandomStrategy>)
  - [func \(s \*WeightedRandomStrategy\) Execute\(ctx context.Context, chain \*Chain, store pocket.Store, input any\) \(any, error\)](<#WeightedRandomStrategy.Execute>)


<a name="ToCircuitBreakerNode"></a>
## func [ToCircuitBreakerNode](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L333>)

```go
func ToCircuitBreakerNode(name string, primary pocket.ExecFunc, fallback Handler, opts ...CircuitOption) pocket.Node
```

ToNode converts a circuit breaker policy to a pocket Node.

<a name="ToNode"></a>
## func [ToNode](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L353>)

```go
func ToNode(policy Policy) pocket.Node
```

ToNode converts a fallback policy to a pocket Node.

<a name="AdaptiveChain"></a>
## type [AdaptiveChain](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L348-L351>)

AdaptiveChain automatically adjusts link weights based on success rates.

```go
type AdaptiveChain struct {
    *Chain
    // contains filtered or unexported fields
}
```

<a name="NewAdaptiveChain"></a>
### func [NewAdaptiveChain](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L354>)

```go
func NewAdaptiveChain(name string, learningRate float64) *AdaptiveChain
```

NewAdaptiveChain creates a chain that learns from execution history.

<a name="AdaptiveChain.Execute"></a>
### func \(\*AdaptiveChain\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L362>)

```go
func (a *AdaptiveChain) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs the chain and updates weights based on results.

<a name="CachedFallbackPolicy"></a>
## type [CachedFallbackPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L216-L222>)

CachedFallbackPolicy uses cached results as fallback.

```go
type CachedFallbackPolicy struct {
    // contains filtered or unexported fields
}
```

<a name="NewCachedFallbackPolicy"></a>
### func [NewCachedFallbackPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L225>)

```go
func NewCachedFallbackPolicy(name string, primary pocket.ExecFunc, cacheKey func(any) string) *CachedFallbackPolicy
```

NewCachedFallbackPolicy creates a policy that falls back to cached results.

<a name="CachedFallbackPolicy.Execute"></a>
### func \(\*CachedFallbackPolicy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L253>)

```go
func (p *CachedFallbackPolicy) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs with cache fallback support.

<a name="CachedFallbackPolicy.Name"></a>
### func \(\*CachedFallbackPolicy\) [Name](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L248>)

```go
func (p *CachedFallbackPolicy) Name() string
```

Name returns the policy name.

<a name="CachedFallbackPolicy.WithStaleOK"></a>
### func \(\*CachedFallbackPolicy\) [WithStaleOK](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L242>)

```go
func (p *CachedFallbackPolicy) WithStaleOK(ok bool) *CachedFallbackPolicy
```

WithStaleOK allows serving stale cache on failure.

<a name="CachedFallbackPolicy.WithTTL"></a>
### func \(\*CachedFallbackPolicy\) [WithTTL](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L236>)

```go
func (p *CachedFallbackPolicy) WithTTL(ttl time.Duration) *CachedFallbackPolicy
```

WithTTL sets the cache TTL.

<a name="Chain"></a>
## type [Chain](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L13-L19>)

Chain represents a sophisticated fallback chain with advanced features.

```go
type Chain struct {
    // contains filtered or unexported fields
}
```

<a name="NewChain"></a>
### func [NewChain](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L46>)

```go
func NewChain(name string) *Chain
```

NewChain creates a new fallback chain.

<a name="Chain.AddLink"></a>
### func \(\*Chain\) [AddLink](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L61>)

```go
func (c *Chain) AddLink(link Link) *Chain
```

AddLink adds a link to the chain.

<a name="Chain.Execute"></a>
### func \(\*Chain\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L82>)

```go
func (c *Chain) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs the fallback chain.

<a name="Chain.GetMetrics"></a>
### func \(\*Chain\) [GetMetrics](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L91>)

```go
func (c *Chain) GetMetrics() MetricsSnapshot
```

GetMetrics returns chain execution metrics.

<a name="Chain.WithStrategy"></a>
### func \(\*Chain\) [WithStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L73>)

```go
func (c *Chain) WithStrategy(strategy Strategy) *Chain
```

WithStrategy sets the execution strategy.

<a name="ChainOption"></a>
## type [ChainOption](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L73>)

ChainOption configures a chain policy.

```go
type ChainOption func(*chainOptions)
```

<a name="CollectErrors"></a>
### func [CollectErrors](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L83>)

```go
func CollectErrors() ChainOption
```

CollectErrors stores all errors encountered.

<a name="StopOnFirstSuccess"></a>
### func [StopOnFirstSuccess](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L76>)

```go
func StopOnFirstSuccess() ChainOption
```

StopOnFirstSuccess stops the chain when a handler succeeds.

<a name="WithTimeout"></a>
### func [WithTimeout](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L90>)

```go
func WithTimeout(d time.Duration) ChainOption
```

WithTimeout sets a timeout for the entire chain.

<a name="ChainPolicy"></a>
## type [ChainPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L60-L64>)

ChainPolicy executes a chain of handlers until one succeeds.

```go
type ChainPolicy struct {
    // contains filtered or unexported fields
}
```

<a name="NewChainPolicy"></a>
### func [NewChainPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L97>)

```go
func NewChainPolicy(name string, handlers []pocket.ExecFunc, opts ...ChainOption) *ChainPolicy
```

NewChainPolicy creates a chain fallback policy.

<a name="ChainPolicy.Execute"></a>
### func \(\*ChainPolicy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L119>)

```go
func (p *ChainPolicy) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs the chain of handlers.

<a name="ChainPolicy.Name"></a>
### func \(\*ChainPolicy\) [Name](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L114>)

```go
func (p *ChainPolicy) Name() string
```

Name returns the policy name.

<a name="CircuitBreaker"></a>
## type [CircuitBreaker](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L40-L65>)

CircuitBreaker implements the circuit breaker pattern.

```go
type CircuitBreaker struct {
    // contains filtered or unexported fields
}
```

<a name="NewCircuitBreaker"></a>
### func [NewCircuitBreaker](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L99>)

```go
func NewCircuitBreaker(name string, opts ...CircuitOption) *CircuitBreaker
```

NewCircuitBreaker creates a new circuit breaker.

<a name="CircuitBreaker.Execute"></a>
### func \(\*CircuitBreaker\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L116>)

```go
func (cb *CircuitBreaker) Execute(ctx context.Context, store pocket.Store, fn pocket.ExecFunc, input any) (any, error)
```

Execute runs the given function through the circuit breaker.

<a name="CircuitBreaker.GetMetrics"></a>
### func \(\*CircuitBreaker\) [GetMetrics](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L261>)

```go
func (cb *CircuitBreaker) GetMetrics() CircuitMetrics
```

GetMetrics returns circuit breaker metrics.

<a name="CircuitBreaker.GetState"></a>
### func \(\*CircuitBreaker\) [GetState](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L254>)

```go
func (cb *CircuitBreaker) GetState() CircuitState
```

GetState returns the current circuit state.

<a name="CircuitBreakerGroup"></a>
## type [CircuitBreakerGroup](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L356-L359>)

CircuitBreakerGroup manages multiple circuit breakers.

```go
type CircuitBreakerGroup struct {
    // contains filtered or unexported fields
}
```

<a name="NewCircuitBreakerGroup"></a>
### func [NewCircuitBreakerGroup](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L362>)

```go
func NewCircuitBreakerGroup() *CircuitBreakerGroup
```

NewCircuitBreakerGroup creates a new circuit breaker group.

<a name="CircuitBreakerGroup.Get"></a>
### func \(\*CircuitBreakerGroup\) [Get](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L369>)

```go
func (g *CircuitBreakerGroup) Get(name string, opts ...CircuitOption) *CircuitBreaker
```

Get returns a circuit breaker by name, creating it if necessary.

<a name="CircuitBreakerGroup.GetAllMetrics"></a>
### func \(\*CircuitBreakerGroup\) [GetAllMetrics](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L394>)

```go
func (g *CircuitBreakerGroup) GetAllMetrics() []CircuitMetrics
```

GetAllMetrics returns metrics for all circuit breakers in the group.

<a name="CircuitBreakerGroup.Reset"></a>
### func \(\*CircuitBreakerGroup\) [Reset](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L407>)

```go
func (g *CircuitBreakerGroup) Reset()
```

Reset resets all circuit breakers in the group.

<a name="CircuitBreakerPolicy"></a>
## type [CircuitBreakerPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L290-L295>)

CircuitBreakerPolicy wraps an exec function with circuit breaker protection.

```go
type CircuitBreakerPolicy struct {
    // contains filtered or unexported fields
}
```

<a name="NewCircuitBreakerPolicy"></a>
### func [NewCircuitBreakerPolicy](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L298>)

```go
func NewCircuitBreakerPolicy(name string, primary pocket.ExecFunc, fallback Handler, opts ...CircuitOption) *CircuitBreakerPolicy
```

NewCircuitBreakerPolicy creates a policy with circuit breaker protection.

<a name="CircuitBreakerPolicy.Execute"></a>
### func \(\*CircuitBreakerPolicy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L313>)

```go
func (p *CircuitBreakerPolicy) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs with circuit breaker protection.

<a name="CircuitBreakerPolicy.Name"></a>
### func \(\*CircuitBreakerPolicy\) [Name](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L308>)

```go
func (p *CircuitBreakerPolicy) Name() string
```

Name returns the policy name.

<a name="CircuitMetrics"></a>
## type [CircuitMetrics](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L278-L287>)

CircuitMetrics contains circuit breaker statistics.

```go
type CircuitMetrics struct {
    Name            string
    State           string
    TotalRequests   int64
    TotalSuccesses  int64
    TotalFailures   int64
    CircuitOpens    int64
    LastOpenTime    time.Time
    CurrentFailures int
}
```

<a name="CircuitOption"></a>
## type [CircuitOption](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L68>)

CircuitOption configures a circuit breaker.

```go
type CircuitOption func(*CircuitBreaker)
```

<a name="WithHalfOpenRequests"></a>
### func [WithHalfOpenRequests](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L85>)

```go
func WithHalfOpenRequests(n int) CircuitOption
```

WithHalfOpenRequests sets the number of test requests in half\-open state.

<a name="WithMaxFailures"></a>
### func [WithMaxFailures](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L71>)

```go
func WithMaxFailures(n int) CircuitOption
```

WithMaxFailures sets the failure threshold.

<a name="WithResetTimeout"></a>
### func [WithResetTimeout](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L78>)

```go
func WithResetTimeout(d time.Duration) CircuitOption
```

WithResetTimeout sets the timeout before attempting recovery.

<a name="WithStateChangeCallback"></a>
### func [WithStateChangeCallback](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L92>)

```go
func WithStateChangeCallback(fn func(from, to CircuitState)) CircuitOption
```

WithStateChangeCallback sets a callback for state transitions.

<a name="CircuitState"></a>
## type [CircuitState](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L14>)

CircuitState represents the state of a circuit breaker.

```go
type CircuitState int
```

<a name="StateClosed"></a>

```go
const (
    // StateClosed allows requests to pass through.
    StateClosed CircuitState = iota
    // StateOpen blocks all requests.
    StateOpen
    // StateHalfOpen allows limited requests to test recovery.
    StateHalfOpen
)
```

<a name="CircuitState.String"></a>
### func \(CircuitState\) [String](<https://github.com/agentstation/pocket/blob/master/fallback/circuit.go#L26>)

```go
func (s CircuitState) String() string
```

String returns the string representation of the circuit state.

<a name="Handler"></a>
## type [Handler](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L22>)

Handler is a function that can serve as a fallback.

```go
type Handler func(ctx context.Context, store pocket.StoreWriter, input any, err error) (any, error)
```

<a name="Link"></a>
## type [Link](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L22-L28>)

Link represents a single link in the fallback chain.

```go
type Link struct {
    Name      string
    Handler   pocket.ExecFunc
    Weight    float64
    Condition func(ctx context.Context, store pocket.Store, input any) bool
    Transform func(input any) any
}
```

<a name="LinkStats"></a>
## type [LinkStats](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L128-L133>)

LinkStats contains statistics for a single link.

```go
type LinkStats struct {
    Executions int64
    Successes  int64
    Failures   int64
    AvgLatency time.Duration
}
```

<a name="Metrics"></a>
## type [Metrics](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L36-L43>)

Metrics tracks chain execution metrics.

```go
type Metrics struct {
    // contains filtered or unexported fields
}
```

<a name="MetricsSnapshot"></a>
## type [MetricsSnapshot](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L122-L125>)

MetricsSnapshot represents a point\-in\-time view of metrics.

```go
type MetricsSnapshot struct {
    TotalExecutions int64
    LinkStats       map[string]LinkStats
}
```

<a name="ParallelStrategy"></a>
## type [ParallelStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L194-L196>)

ParallelStrategy executes links concurrently and returns the first success.

```go
type ParallelStrategy struct {
    // contains filtered or unexported fields
}
```

<a name="NewParallelStrategy"></a>
### func [NewParallelStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L199>)

```go
func NewParallelStrategy(timeout time.Duration) *ParallelStrategy
```

NewParallelStrategy creates a parallel execution strategy.

<a name="ParallelStrategy.Execute"></a>
### func \(\*ParallelStrategy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L203>)

```go
func (s *ParallelStrategy) Execute(ctx context.Context, chain *Chain, store pocket.Store, input any) (any, error)
```



<a name="Policy"></a>
## type [Policy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L14-L19>)

Policy defines a fallback strategy.

```go
type Policy interface {
    // Execute runs the primary function with fallback support.
    Execute(ctx context.Context, store pocket.Store, input any) (any, error)
    // Name returns the policy name.
    Name() string
}
```

<a name="PolicyBuilder"></a>
## type [PolicyBuilder](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L292-L295>)

PolicyBuilder helps construct complex fallback policies.

```go
type PolicyBuilder struct {
    // contains filtered or unexported fields
}
```

<a name="NewPolicyBuilder"></a>
### func [NewPolicyBuilder](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L324>)

```go
func NewPolicyBuilder(name string) *PolicyBuilder
```

NewPolicyBuilder creates a new policy builder.

<a name="PolicyBuilder.Add"></a>
### func \(\*PolicyBuilder\) [Add](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L332>)

```go
func (b *PolicyBuilder) Add(policy Policy) *PolicyBuilder
```

Add adds a policy to the builder.

<a name="PolicyBuilder.Build"></a>
### func \(\*PolicyBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L338>)

```go
func (b *PolicyBuilder) Build() Policy
```

Build creates a composite policy.

<a name="SequentialStrategy"></a>
## type [SequentialStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L136>)

SequentialStrategy executes links in order until one succeeds.

```go
type SequentialStrategy struct{}
```

<a name="SequentialStrategy.Execute"></a>
### func \(\*SequentialStrategy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L138>)

```go
func (s *SequentialStrategy) Execute(ctx context.Context, chain *Chain, store pocket.Store, input any) (any, error)
```



<a name="SimplePolicy"></a>
## type [SimplePolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L25-L29>)

SimplePolicy provides basic fallback functionality.

```go
type SimplePolicy struct {
    // contains filtered or unexported fields
}
```

<a name="NewSimplePolicy"></a>
### func [NewSimplePolicy](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L32>)

```go
func NewSimplePolicy(name string, primary pocket.ExecFunc, fallback Handler) *SimplePolicy
```

NewSimplePolicy creates a basic fallback policy.

<a name="SimplePolicy.Execute"></a>
### func \(\*SimplePolicy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L46>)

```go
func (p *SimplePolicy) Execute(ctx context.Context, store pocket.Store, input any) (any, error)
```

Execute runs with fallback support.

<a name="SimplePolicy.Name"></a>
### func \(\*SimplePolicy\) [Name](<https://github.com/agentstation/pocket/blob/master/fallback/policy.go#L41>)

```go
func (p *SimplePolicy) Name() string
```

Name returns the policy name.

<a name="Strategy"></a>
## type [Strategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L31-L33>)

Strategy defines how the chain executes.

```go
type Strategy interface {
    Execute(ctx context.Context, chain *Chain, store pocket.Store, input any) (any, error)
}
```

<a name="WeightedRandomStrategy"></a>
## type [WeightedRandomStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L276-L279>)

WeightedRandomStrategy randomly selects links based on weights.

```go
type WeightedRandomStrategy struct {
    // contains filtered or unexported fields
}
```

<a name="NewWeightedRandomStrategy"></a>
### func [NewWeightedRandomStrategy](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L282>)

```go
func NewWeightedRandomStrategy(maxAttempts int) *WeightedRandomStrategy
```

NewWeightedRandomStrategy creates a weighted random strategy.

<a name="WeightedRandomStrategy.Execute"></a>
### func \(\*WeightedRandomStrategy\) [Execute](<https://github.com/agentstation/pocket/blob/master/fallback/chain.go#L289>)

```go
func (s *WeightedRandomStrategy) Execute(ctx context.Context, chain *Chain, store pocket.Store, input any) (any, error)
```



# middleware

```go
import "github.com/agentstation/pocket/middleware"
```

Package middleware provides node enhancement patterns for cross\-cutting concerns like logging, metrics, retries, and circuit breakers.

## Index

- [func Apply\(node pocket.Node, middlewares ...Middleware\) pocket.Node](<#Apply>)
- [type MetricsCollector](<#MetricsCollector>)
- [type Middleware](<#Middleware>)
  - [func Chain\(middlewares ...Middleware\) Middleware](<#Chain>)
  - [func CircuitBreaker\(threshold int, timeout time.Duration\) Middleware](<#CircuitBreaker>)
  - [func ErrorHandler\(handler func\(error\) error\) Middleware](<#ErrorHandler>)
  - [func Logging\(logger pocket.Logger\) Middleware](<#Logging>)
  - [func Metrics\(collector MetricsCollector\) Middleware](<#Metrics>)
  - [func RateLimit\(rps, burst int\) Middleware](<#RateLimit>)
  - [func Retry\(maxAttempts int, backoff time.Duration\) Middleware](<#Retry>)
  - [func Timeout\(duration time.Duration\) Middleware](<#Timeout>)
  - [func Timing\(\) Middleware](<#Timing>)
  - [func Transform\(transformInput, transformOutput func\(any\) any\) Middleware](<#Transform>)
  - [func Validation\(validateInput, validateOutput func\(any\) error\) Middleware](<#Validation>)


<a name="Apply"></a>
## func [Apply](<https://github.com/agentstation/pocket/blob/master/middleware/middleware.go#L77>)

```go
func Apply(node pocket.Node, middlewares ...Middleware) pocket.Node
```

Apply applies middleware to a node.

<a name="MetricsCollector"></a>
## type [MetricsCollector](<https://github.com/agentstation/pocket/blob/master/middleware/metrics.go#L10-L14>)

MetricsCollector collects node execution metrics.

```go
type MetricsCollector interface {
    RecordPhaseStart(nodeName, phase string)
    RecordPhaseEnd(nodeName, phase string, err error)
    RecordRouting(nodeName, next string)
}
```

<a name="Middleware"></a>
## type [Middleware](<https://github.com/agentstation/pocket/blob/master/middleware/middleware.go#L13>)

Middleware modifies node behavior.

```go
type Middleware func(pocket.Node) pocket.Node
```

<a name="Chain"></a>
### func [Chain](<https://github.com/agentstation/pocket/blob/master/middleware/middleware.go#L67>)

```go
func Chain(middlewares ...Middleware) Middleware
```

Chain combines multiple middlewares into a single middleware. Middlewares are applied in reverse order \(like function composition\).

<a name="CircuitBreaker"></a>
### func [CircuitBreaker](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L122>)

```go
func CircuitBreaker(threshold int, timeout time.Duration) Middleware
```

CircuitBreaker adds circuit breaker pattern.

<a name="ErrorHandler"></a>
### func [ErrorHandler](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L241>)

```go
func ErrorHandler(handler func(error) error) Middleware
```

ErrorHandler adds custom error handling.

<a name="Logging"></a>
### func [Logging](<https://github.com/agentstation/pocket/blob/master/middleware/logging.go#L12>)

```go
func Logging(logger pocket.Logger) Middleware
```

Logging adds structured logging to a node's lifecycle.

<a name="Metrics"></a>
### func [Metrics](<https://github.com/agentstation/pocket/blob/master/middleware/metrics.go#L17>)

```go
func Metrics(collector MetricsCollector) Middleware
```

Metrics adds comprehensive metrics collection to a node.

<a name="RateLimit"></a>
### func [RateLimit](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L73>)

```go
func RateLimit(rps, burst int) Middleware
```

RateLimit adds rate limiting to a node using a token bucket.

<a name="Retry"></a>
### func [Retry](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L13>)

```go
func Retry(maxAttempts int, backoff time.Duration) Middleware
```

Retry adds retry logic with exponential backoff.

<a name="Timeout"></a>
### func [Timeout](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L43>)

```go
func Timeout(duration time.Duration) Middleware
```

Timeout adds timeout to node execution.

<a name="Timing"></a>
### func [Timing](<https://github.com/agentstation/pocket/blob/master/middleware/timing.go#L12>)

```go
func Timing() Middleware
```

Timing adds execution timing to a node, storing metrics in the store.

<a name="Transform"></a>
### func [Transform](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L210>)

```go
func Transform(transformInput, transformOutput func(any) any) Middleware
```

Transform adds input/output transformation.

<a name="Validation"></a>
### func [Validation](<https://github.com/agentstation/pocket/blob/master/middleware/patterns.go#L174>)

```go
func Validation(validateInput, validateOutput func(any) error) Middleware
```

Validation adds input/output validation.

# nodes

```go
import "github.com/agentstation/pocket/nodes"
```

Package nodes provides the built\-in node types for Pocket workflows. These nodes are available out\-of\-the\-box and provide core functionality for data manipulation, I/O operations, flow control, and more.

The package is organized into categories:

- core: Essential nodes like echo, delay, router, conditional
- data: Data manipulation nodes like transform, template, jsonpath
- io: I/O operations like http, file
- flow: Flow control nodes like parallel, retry, cache

Each node type is registered with metadata that describes its configuration schema, inputs, outputs, and usage examples.

## Index

- [func ValidateAllNodeConfigs\(registry \*Registry, configs map\[string\]map\[string\]interface\{\}\) error](<#ValidateAllNodeConfigs>)
- [func ValidateNodeConfig\(meta \*Metadata, config map\[string\]interface\{\}\) error](<#ValidateNodeConfig>)
- [type AggregateNodeBuilder](<#AggregateNodeBuilder>)
  - [func \(b \*AggregateNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#AggregateNodeBuilder.Build>)
  - [func \(b \*AggregateNodeBuilder\) Metadata\(\) Metadata](<#AggregateNodeBuilder.Metadata>)
- [type ConditionalNodeBuilder](<#ConditionalNodeBuilder>)
  - [func \(b \*ConditionalNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#ConditionalNodeBuilder.Build>)
  - [func \(b \*ConditionalNodeBuilder\) Metadata\(\) Metadata](<#ConditionalNodeBuilder.Metadata>)
- [type DelayNodeBuilder](<#DelayNodeBuilder>)
  - [func \(b \*DelayNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#DelayNodeBuilder.Build>)
  - [func \(b \*DelayNodeBuilder\) Metadata\(\) Metadata](<#DelayNodeBuilder.Metadata>)
- [type EchoNodeBuilder](<#EchoNodeBuilder>)
  - [func \(b \*EchoNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#EchoNodeBuilder.Build>)
  - [func \(b \*EchoNodeBuilder\) Metadata\(\) Metadata](<#EchoNodeBuilder.Metadata>)
- [type Example](<#Example>)
- [type ExecNodeBuilder](<#ExecNodeBuilder>)
  - [func \(b \*ExecNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#ExecNodeBuilder.Build>)
  - [func \(b \*ExecNodeBuilder\) Metadata\(\) Metadata](<#ExecNodeBuilder.Metadata>)
- [type FileNodeBuilder](<#FileNodeBuilder>)
  - [func \(b \*FileNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#FileNodeBuilder.Build>)
  - [func \(b \*FileNodeBuilder\) Metadata\(\) Metadata](<#FileNodeBuilder.Metadata>)
- [type HTTPNodeBuilder](<#HTTPNodeBuilder>)
  - [func \(b \*HTTPNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#HTTPNodeBuilder.Build>)
  - [func \(b \*HTTPNodeBuilder\) Metadata\(\) Metadata](<#HTTPNodeBuilder.Metadata>)
- [type JSONPathNodeBuilder](<#JSONPathNodeBuilder>)
  - [func \(b \*JSONPathNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#JSONPathNodeBuilder.Build>)
  - [func \(b \*JSONPathNodeBuilder\) Metadata\(\) Metadata](<#JSONPathNodeBuilder.Metadata>)
- [type LuaNodeBuilder](<#LuaNodeBuilder>)
  - [func \(b \*LuaNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#LuaNodeBuilder.Build>)
  - [func \(b \*LuaNodeBuilder\) Metadata\(\) Metadata](<#LuaNodeBuilder.Metadata>)
- [type Metadata](<#Metadata>)
- [type NodeBuilder](<#NodeBuilder>)
- [type ParallelNodeBuilder](<#ParallelNodeBuilder>)
  - [func \(b \*ParallelNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#ParallelNodeBuilder.Build>)
  - [func \(b \*ParallelNodeBuilder\) Metadata\(\) Metadata](<#ParallelNodeBuilder.Metadata>)
- [type Registry](<#Registry>)
  - [func NewRegistry\(\) \*Registry](<#NewRegistry>)
  - [func RegisterAll\(loader \*yaml.Loader, verbose bool\) \*Registry](<#RegisterAll>)
  - [func \(r \*Registry\) All\(\) map\[string\]NodeBuilder](<#Registry.All>)
  - [func \(r \*Registry\) Get\(nodeType string\) \(NodeBuilder, bool\)](<#Registry.Get>)
  - [func \(r \*Registry\) Register\(builder NodeBuilder\)](<#Registry.Register>)
- [type RouterNodeBuilder](<#RouterNodeBuilder>)
  - [func \(b \*RouterNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#RouterNodeBuilder.Build>)
  - [func \(b \*RouterNodeBuilder\) Metadata\(\) Metadata](<#RouterNodeBuilder.Metadata>)
- [type TemplateNodeBuilder](<#TemplateNodeBuilder>)
  - [func \(b \*TemplateNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#TemplateNodeBuilder.Build>)
  - [func \(b \*TemplateNodeBuilder\) Metadata\(\) Metadata](<#TemplateNodeBuilder.Metadata>)
- [type TransformNodeBuilder](<#TransformNodeBuilder>)
  - [func \(b \*TransformNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#TransformNodeBuilder.Build>)
  - [func \(b \*TransformNodeBuilder\) Metadata\(\) Metadata](<#TransformNodeBuilder.Metadata>)
- [type ValidateNodeBuilder](<#ValidateNodeBuilder>)
  - [func \(b \*ValidateNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#ValidateNodeBuilder.Build>)
  - [func \(b \*ValidateNodeBuilder\) Metadata\(\) Metadata](<#ValidateNodeBuilder.Metadata>)


<a name="ValidateAllNodeConfigs"></a>
## func [ValidateAllNodeConfigs](<https://github.com/agentstation/pocket/blob/master/nodes/validation.go#L54>)

```go
func ValidateAllNodeConfigs(registry *Registry, configs map[string]map[string]interface{}) error
```

ValidateAllNodeConfigs validates all node configurations in a registry.

<a name="ValidateNodeConfig"></a>
## func [ValidateNodeConfig](<https://github.com/agentstation/pocket/blob/master/nodes/validation.go#L11>)

```go
func ValidateNodeConfig(meta *Metadata, config map[string]interface{}) error
```

ValidateNodeConfig validates a node configuration against its schema.

<a name="AggregateNodeBuilder"></a>
## type [AggregateNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1183-L1185>)

AggregateNodeBuilder builds data aggregation nodes.

```go
type AggregateNodeBuilder struct {
    Verbose bool
}
```

<a name="AggregateNodeBuilder.Build"></a>
### func \(\*AggregateNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1293>)

```go
func (b *AggregateNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates an aggregate node from a definition.

<a name="AggregateNodeBuilder.Metadata"></a>
### func \(\*AggregateNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1188>)

```go
func (b *AggregateNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="ConditionalNodeBuilder"></a>
## type [ConditionalNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L313-L315>)

ConditionalNodeBuilder builds conditional routing nodes.

```go
type ConditionalNodeBuilder struct {
    Verbose bool
}
```

<a name="ConditionalNodeBuilder.Build"></a>
### func \(\*ConditionalNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L371>)

```go
func (b *ConditionalNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a conditional node from a definition.

<a name="ConditionalNodeBuilder.Metadata"></a>
### func \(\*ConditionalNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L318>)

```go
func (b *ConditionalNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="DelayNodeBuilder"></a>
## type [DelayNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L112-L114>)

DelayNodeBuilder builds delay nodes.

```go
type DelayNodeBuilder struct {
    Verbose bool
}
```

<a name="DelayNodeBuilder.Build"></a>
### func \(\*DelayNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L154>)

```go
func (b *DelayNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a delay node from a definition.

<a name="DelayNodeBuilder.Metadata"></a>
### func \(\*DelayNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L117>)

```go
func (b *DelayNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="EchoNodeBuilder"></a>
## type [EchoNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L29-L31>)

EchoNodeBuilder builds echo nodes.

```go
type EchoNodeBuilder struct {
    Verbose bool
}
```

<a name="EchoNodeBuilder.Build"></a>
### func \(\*EchoNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L89>)

```go
func (b *EchoNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates an echo node from a definition.

<a name="EchoNodeBuilder.Metadata"></a>
### func \(\*EchoNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L34>)

```go
func (b *EchoNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="Example"></a>
## type [Example](<https://github.com/agentstation/pocket/blob/master/nodes/types.go#L16-L22>)

Example shows how to use a node.

```go
type Example struct {
    Name        string                 `json:"name"`
    Description string                 `json:"description"`
    Config      map[string]interface{} `json:"config"`
    Input       interface{}            `json:"input,omitempty"`
    Output      interface{}            `json:"output,omitempty"`
}
```

<a name="ExecNodeBuilder"></a>
## type [ExecNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1792-L1794>)

ExecNodeBuilder builds command execution nodes.

```go
type ExecNodeBuilder struct {
    Verbose bool
}
```

<a name="ExecNodeBuilder.Build"></a>
### func \(\*ExecNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1898>)

```go
func (b *ExecNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates an exec node from a definition.

<a name="ExecNodeBuilder.Metadata"></a>
### func \(\*ExecNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1796>)

```go
func (b *ExecNodeBuilder) Metadata() Metadata
```



<a name="FileNodeBuilder"></a>
## type [FileNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1406-L1408>)

FileNodeBuilder builds file I/O nodes with sandboxing.

```go
type FileNodeBuilder struct {
    Verbose bool
}
```

<a name="FileNodeBuilder.Build"></a>
### func \(\*FileNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1556>)

```go
func (b *FileNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a file node from a definition.

<a name="FileNodeBuilder.Metadata"></a>
### func \(\*FileNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1411>)

```go
func (b *FileNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="HTTPNodeBuilder"></a>
## type [HTTPNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L599-L601>)

HTTPNodeBuilder builds HTTP client nodes.

```go
type HTTPNodeBuilder struct {
    Verbose bool
}
```

<a name="HTTPNodeBuilder.Build"></a>
### func \(\*HTTPNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L685>)

```go
func (b *HTTPNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates an HTTP node from a definition.

<a name="HTTPNodeBuilder.Metadata"></a>
### func \(\*HTTPNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L604>)

```go
func (b *HTTPNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="JSONPathNodeBuilder"></a>
## type [JSONPathNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L834-L836>)

JSONPathNodeBuilder builds JSONPath extraction nodes.

```go
type JSONPathNodeBuilder struct {
    Verbose bool
}
```

<a name="JSONPathNodeBuilder.Build"></a>
### func \(\*JSONPathNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L916>)

```go
func (b *JSONPathNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a JSONPath node from a definition.

<a name="JSONPathNodeBuilder.Metadata"></a>
### func \(\*JSONPathNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L839>)

```go
func (b *JSONPathNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="LuaNodeBuilder"></a>
## type [LuaNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2396-L2398>)

LuaNodeBuilder builds Lua script nodes.

```go
type LuaNodeBuilder struct {
    Verbose bool
}
```

<a name="LuaNodeBuilder.Build"></a>
### func \(\*LuaNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2468>)

```go
func (b *LuaNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a new Lua script node.

<a name="LuaNodeBuilder.Metadata"></a>
### func \(\*LuaNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2401>)

```go
func (b *LuaNodeBuilder) Metadata() Metadata
```

Metadata returns metadata for the Lua node.

<a name="Metadata"></a>
## type [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/types.go#L4-L13>)

Metadata describes a node type.

```go
type Metadata struct {
    Type         string                 `json:"type"`
    Category     string                 `json:"category"`
    Description  string                 `json:"description"`
    InputSchema  map[string]interface{} `json:"inputSchema,omitempty"`
    OutputSchema map[string]interface{} `json:"outputSchema,omitempty"`
    ConfigSchema map[string]interface{} `json:"configSchema"`
    Examples     []Example              `json:"examples,omitempty"`
    Since        string                 `json:"since,omitempty"`
}
```

<a name="NodeBuilder"></a>
## type [NodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L11-L14>)

NodeBuilder creates nodes and provides metadata.

```go
type NodeBuilder interface {
    Metadata() Metadata
    Build(def *yaml.NodeDefinition) (pocket.Node, error)
}
```

<a name="ParallelNodeBuilder"></a>
## type [ParallelNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2043-L2045>)

ParallelNodeBuilder builds parallel execution nodes.

```go
type ParallelNodeBuilder struct {
    Verbose bool
}
```

<a name="ParallelNodeBuilder.Build"></a>
### func \(\*ParallelNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2163>)

```go
func (b *ParallelNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a parallel node from a definition.

<a name="ParallelNodeBuilder.Metadata"></a>
### func \(\*ParallelNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L2047>)

```go
func (b *ParallelNodeBuilder) Metadata() Metadata
```



<a name="Registry"></a>
## type [Registry](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L17-L19>)

Registry manages all built\-in nodes.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="NewRegistry"></a>
### func [NewRegistry](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L22>)

```go
func NewRegistry() *Registry
```

NewRegistry creates a new node registry.

<a name="RegisterAll"></a>
### func [RegisterAll](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L46>)

```go
func RegisterAll(loader *yaml.Loader, verbose bool) *Registry
```

RegisterAll registers all built\-in nodes with a YAML loader.

<a name="Registry.All"></a>
### func \(\*Registry\) [All](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L41>)

```go
func (r *Registry) All() map[string]NodeBuilder
```

All returns all registered builders.

<a name="Registry.Get"></a>
### func \(\*Registry\) [Get](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L35>)

```go
func (r *Registry) Get(nodeType string) (NodeBuilder, bool)
```

Get returns a builder by type.

<a name="Registry.Register"></a>
### func \(\*Registry\) [Register](<https://github.com/agentstation/pocket/blob/master/nodes/registry.go#L29>)

```go
func (r *Registry) Register(builder NodeBuilder)
```

Register adds a node builder.

<a name="RouterNodeBuilder"></a>
## type [RouterNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L180-L182>)

RouterNodeBuilder builds router nodes.

```go
type RouterNodeBuilder struct {
    Verbose bool
}
```

<a name="RouterNodeBuilder.Build"></a>
### func \(\*RouterNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L219>)

```go
func (b *RouterNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a router node from a definition.

<a name="RouterNodeBuilder.Metadata"></a>
### func \(\*RouterNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L185>)

```go
func (b *RouterNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="TemplateNodeBuilder"></a>
## type [TemplateNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L445-L447>)

TemplateNodeBuilder builds template rendering nodes.

```go
type TemplateNodeBuilder struct {
    Verbose bool
}
```

<a name="TemplateNodeBuilder.Build"></a>
### func \(\*TemplateNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L513>)

```go
func (b *TemplateNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a template node from a definition.

<a name="TemplateNodeBuilder.Metadata"></a>
### func \(\*TemplateNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L450>)

```go
func (b *TemplateNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="TransformNodeBuilder"></a>
## type [TransformNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L238-L240>)

TransformNodeBuilder builds transform nodes.

```go
type TransformNodeBuilder struct {
    Verbose bool
}
```

<a name="TransformNodeBuilder.Build"></a>
### func \(\*TransformNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L282>)

```go
func (b *TransformNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a transform node from a definition.

<a name="TransformNodeBuilder.Metadata"></a>
### func \(\*TransformNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L243>)

```go
func (b *TransformNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

<a name="ValidateNodeBuilder"></a>
## type [ValidateNodeBuilder](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L980-L982>)

ValidateNodeBuilder builds JSON Schema validation nodes.

```go
type ValidateNodeBuilder struct {
    Verbose bool
}
```

<a name="ValidateNodeBuilder.Build"></a>
### func \(\*ValidateNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L1102>)

```go
func (b *ValidateNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a validate node from a definition.

<a name="ValidateNodeBuilder.Metadata"></a>
### func \(\*ValidateNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/nodes/builders.go#L985>)

```go
func (b *ValidateNodeBuilder) Metadata() Metadata
```

Metadata returns the node metadata.

# plugins

```go
import "github.com/agentstation/pocket/plugins"
```

Package plugins provides the core interfaces and types for the Pocket plugin system.

## Index

- [type Example](<#Example>)
- [type Loader](<#Loader>)
- [type Metadata](<#Metadata>)
- [type NodeDefinition](<#NodeDefinition>)
- [type Permissions](<#Permissions>)
- [type Plugin](<#Plugin>)
- [type Registry](<#Registry>)
- [type Request](<#Request>)
- [type Requirements](<#Requirements>)
- [type Response](<#Response>)


<a name="Example"></a>
## type [Example](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L58-L64>)

Example shows how to use a node.

```go
type Example struct {
    Name        string                 `json:"name" yaml:"name"`
    Description string                 `json:"description,omitempty" yaml:"description,omitempty"`
    Config      map[string]interface{} `json:"config,omitempty" yaml:"config,omitempty"`
    Input       interface{}            `json:"input,omitempty" yaml:"input,omitempty"`
    Output      interface{}            `json:"output,omitempty" yaml:"output,omitempty"`
}
```

<a name="Loader"></a>
## type [Loader](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L122-L131>)

Loader discovers and loads plugins.

```go
type Loader interface {
    // Discover finds all plugins in the given paths
    Discover(paths ...string) ([]Metadata, error)

    // Load loads a plugin from the given path
    Load(ctx context.Context, path string) (Plugin, error)

    // LoadFromMetadata loads a plugin using its metadata
    LoadFromMetadata(ctx context.Context, metadata Metadata) (Plugin, error)
}
```

<a name="Metadata"></a>
## type [Metadata](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L23-L44>)

Metadata contains plugin information.

```go
type Metadata struct {
    // Basic info
    Name        string `json:"name" yaml:"name"`
    Version     string `json:"version" yaml:"version"`
    Description string `json:"description" yaml:"description"`
    Author      string `json:"author" yaml:"author"`
    License     string `json:"license,omitempty" yaml:"license,omitempty"`

    // Runtime requirements
    Runtime    string `json:"runtime" yaml:"runtime"`                           // "wasm" for now
    Binary     string `json:"binary" yaml:"binary"`                             // Path to .wasm file
    EntryPoint string `json:"entryPoint,omitempty" yaml:"entryPoint,omitempty"` // Main function

    // Node definitions
    Nodes []NodeDefinition `json:"nodes" yaml:"nodes"`

    // Security permissions
    Permissions Permissions `json:"permissions,omitempty" yaml:"permissions,omitempty"`

    // Requirements
    Requirements Requirements `json:"requirements,omitempty" yaml:"requirements,omitempty"`
}
```

<a name="NodeDefinition"></a>
## type [NodeDefinition](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L47-L55>)

NodeDefinition describes a node exported by the plugin.

```go
type NodeDefinition struct {
    Type         string                 `json:"type" yaml:"type"`
    Category     string                 `json:"category" yaml:"category"`
    Description  string                 `json:"description" yaml:"description"`
    ConfigSchema map[string]interface{} `json:"configSchema,omitempty" yaml:"configSchema,omitempty"`
    InputSchema  map[string]interface{} `json:"inputSchema,omitempty" yaml:"inputSchema,omitempty"`
    OutputSchema map[string]interface{} `json:"outputSchema,omitempty" yaml:"outputSchema,omitempty"`
    Examples     []Example              `json:"examples,omitempty" yaml:"examples,omitempty"`
}
```

<a name="Permissions"></a>
## type [Permissions](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L67-L81>)

Permissions defines what the plugin is allowed to access.

```go
type Permissions struct {
    // Network access
    Network []string `json:"network,omitempty" yaml:"network,omitempty"` // Allowed domains/patterns

    // Environment variables
    Env []string `json:"env,omitempty" yaml:"env,omitempty"` // Allowed env var names

    // File system access
    Filesystem []string `json:"filesystem,omitempty" yaml:"filesystem,omitempty"` // Allowed paths

    // Resource limits
    Memory  string        `json:"memory,omitempty" yaml:"memory,omitempty"`   // Max memory (e.g., "100MB")
    CPU     string        `json:"cpu,omitempty" yaml:"cpu,omitempty"`         // Max CPU time per call
    Timeout time.Duration `json:"timeout,omitempty" yaml:"timeout,omitempty"` // Max execution time
}
```

<a name="Plugin"></a>
## type [Plugin](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L11-L20>)

Plugin represents a loaded plugin instance.

```go
type Plugin interface {
    // Metadata returns the plugin's metadata
    Metadata() Metadata

    // Call invokes a function exported by the plugin
    Call(ctx context.Context, function string, input []byte) ([]byte, error)

    // Close releases plugin resources
    Close(ctx context.Context) error
}
```

<a name="Registry"></a>
## type [Registry](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L134-L146>)

Registry manages loaded plugins.

```go
type Registry interface {
    // Register adds a plugin to the registry
    Register(plugin Plugin) error

    // Get retrieves a plugin by name
    Get(name string) (Plugin, bool)

    // List returns all registered plugins
    List() []Plugin

    // Close releases all plugin resources
    Close(ctx context.Context) error
}
```

<a name="Request"></a>
## type [Request](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L90-L106>)

Request is sent to plugin functions.

```go
type Request struct {
    // Node type being invoked
    Node string `json:"node"`

    // Function to call (prep, exec, post)
    Function string `json:"function"`

    // Node configuration
    Config map[string]interface{} `json:"config,omitempty"`

    // Input data
    Input json.RawMessage `json:"input,omitempty"`

    // Additional data for post function
    PrepResult json.RawMessage `json:"prepResult,omitempty"`
    ExecResult json.RawMessage `json:"execResult,omitempty"`
}
```

<a name="Requirements"></a>
## type [Requirements](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L84-L87>)

Requirements specifies plugin dependencies.

```go
type Requirements struct {
    Pocket string `json:"pocket,omitempty" yaml:"pocket,omitempty"` // Min Pocket version
    Memory string `json:"memory,omitempty" yaml:"memory,omitempty"` // Required memory
}
```

<a name="Response"></a>
## type [Response](<https://github.com/agentstation/pocket/blob/master/plugins/plugin.go#L109-L119>)

Response is returned from plugin functions.

```go
type Response struct {
    // Success/error status
    Success bool   `json:"success"`
    Error   string `json:"error,omitempty"`

    // Function results
    Output json.RawMessage `json:"output,omitempty"`

    // For post function - routing decision
    Next string `json:"next,omitempty"`
}
```

# yaml

```go
import "github.com/agentstation/pocket/yaml"
```

Package yaml provides YAML\-based workflow definition and loading capabilities, enabling configuration\-driven graph construction.

Package yaml provides YAML\-based graph definition support for pocket.

<details><summary>Example</summary>
<p>

Example shows what a YAML graph definition would look like.

```go
package main

import (
	"bytes"
	"fmt"
	"io"
	"os"
)

// Parser handles parsing YAML graph definitions.
type Parser struct {
	// Future: Add schema validation, custom marshalers, etc.
}

// NewParser creates a new YAML parser.
func NewParser() *Parser {
	return &Parser{}
}

// Parse reads and parses a YAML graph definition from a reader.
func (p *Parser) Parse(r io.Reader) (*GraphDefinition, error) {
	// Note: We're not importing yaml.v3 to keep the package dependency-free.
	// This is a placeholder that would need a YAML library in practice.
	// For now, we'll return an error indicating YAML support needs to be enabled.
	return nil, fmt.Errorf("YAML parsing requires importing a YAML library (e.g., github.com/goccy/go-yaml)")
}

// ParseFile reads and parses a YAML graph definition from a file.
func (p *Parser) ParseFile(filename string) (*GraphDefinition, error) {
	// #nosec G304 - This is a parser that needs to accept arbitrary file paths
	// In production, callers should validate the path based on their security requirements
	file, err := os.Open(filename)
	if err != nil {
		return nil, fmt.Errorf("open file: %w", err)
	}
	defer func() { _ = file.Close() }()

	return p.Parse(file)
}

// ParseString parses a YAML graph definition from a string.
func (p *Parser) ParseString(s string) (*GraphDefinition, error) {
	return p.Parse(bytes.NewReader([]byte(s)))
}

// Marshal converts a graph definition to YAML format.
func (p *Parser) Marshal(gd *GraphDefinition) ([]byte, error) {
	// Placeholder - would use YAML library
	return nil, fmt.Errorf("YAML marshaling requires importing a YAML library")
}

// MarshalToFile writes a graph definition to a YAML file.
func (p *Parser) MarshalToFile(gd *GraphDefinition, filename string) error {
	data, err := p.Marshal(gd)
	if err != nil {
		return err
	}

	return os.WriteFile(filename, data, 0o600)
}

// Example shows what a YAML graph definition would look like.
func main() string {
	return `name: chat_workflow
description: Multi-agent chat workflow with routing
version: "1.0.0"
start: input_validator

nodes:
  - name: input_validator
    type: validator
    config:
      required_fields: ["message", "user_id"]
    timeout: 5s
    
  - name: intent_classifier
    type: llm
    config:
      model: "gpt-4"
      prompt: "Classify the intent of this message: {{.message}}"
    retry:
      max_attempts: 3
      delay: 1s
      multiplier: 2
      
  - name: knowledge_search
    type: rag
    config:
      index: "knowledge_base"
      top_k: 5
      
  - name: response_generator
    type: llm
    config:
      model: "gpt-4"
      prompt: "Generate a response based on: {{.context}}"
      
  - name: output_formatter
    type: formatter
    config:
      format: "markdown"

connections:
  - from: input_validator
    to: intent_classifier
    action: valid
    
  - from: intent_classifier
    to: knowledge_search
    action: needs_info
    
  - from: intent_classifier
    to: response_generator
    action: direct_response
    
  - from: knowledge_search
    to: response_generator
    action: default
    
  - from: response_generator
    to: output_formatter
    action: default
`
}
```

</p>
</details>

## Index

- [func Example\(\) string](<#Example>)
- [func FromYAML\(yamlStr string, target any\) error](<#FromYAML>)
- [func LLMNodeBuilder\(def \*NodeDefinition\) \(pocket.Node, error\)](<#LLMNodeBuilder>)
- [func ToYAML\(data any\) \(string, error\)](<#ToYAML>)
- [func ValidatorNodeBuilder\(def \*NodeDefinition\) \(pocket.Node, error\)](<#ValidatorNodeBuilder>)
- [func YAMLNode\(name string, execFn pocket.ExecFunc\) pocket.Node](<#YAMLNode>)
- [func YAMLNodeWithLifecycle\(name string, prep pocket.PrepFunc, exec pocket.ExecFunc, post pocket.PostFunc\) pocket.Node](<#YAMLNodeWithLifecycle>)
- [type Connection](<#Connection>)
- [type GraphDefinition](<#GraphDefinition>)
  - [func \(gd \*GraphDefinition\) Validate\(\) error](<#GraphDefinition.Validate>)
- [type Loader](<#Loader>)
  - [func NewLoader\(\) \*Loader](<#NewLoader>)
  - [func \(l \*Loader\) LoadDefinition\(def \*GraphDefinition, store pocket.Store\) \(\*pocket.Graph, error\)](<#Loader.LoadDefinition>)
  - [func \(l \*Loader\) LoadFile\(filename string, store pocket.Store\) \(\*pocket.Graph, error\)](<#Loader.LoadFile>)
  - [func \(l \*Loader\) LoadString\(yamlStr string, store pocket.Store\) \(\*pocket.Graph, error\)](<#Loader.LoadString>)
  - [func \(l \*Loader\) RegisterNodeType\(nodeType string, builder NodeBuilder\)](<#Loader.RegisterNodeType>)
  - [func \(l \*Loader\) WithNodeFactory\(factory NodeFactory\) \*Loader](<#Loader.WithNodeFactory>)
- [type NodeBuilder](<#NodeBuilder>)
- [type NodeDefinition](<#NodeDefinition>)
  - [func \(nd \*NodeDefinition\) GetTimeout\(\) \(time.Duration, error\)](<#NodeDefinition.GetTimeout>)
  - [func \(nd \*NodeDefinition\) Validate\(\) error](<#NodeDefinition.Validate>)
- [type NodeFactory](<#NodeFactory>)
- [type Parser](<#Parser>)
  - [func NewParser\(\) \*Parser](<#NewParser>)
  - [func \(p \*Parser\) Marshal\(gd \*GraphDefinition\) \(\[\]byte, error\)](<#Parser.Marshal>)
  - [func \(p \*Parser\) MarshalToFile\(gd \*GraphDefinition, filename string\) error](<#Parser.MarshalToFile>)
  - [func \(p \*Parser\) Parse\(r io.Reader\) \(\*GraphDefinition, error\)](<#Parser.Parse>)
  - [func \(p \*Parser\) ParseFile\(filename string\) \(\*GraphDefinition, error\)](<#Parser.ParseFile>)
  - [func \(p \*Parser\) ParseString\(s string\) \(\*GraphDefinition, error\)](<#Parser.ParseString>)
- [type RetryConfig](<#RetryConfig>)
  - [func \(rc \*RetryConfig\) GetMaxDelay\(\) \(time.Duration, error\)](<#RetryConfig.GetMaxDelay>)
  - [func \(rc \*RetryConfig\) GetRetryDelay\(\) \(time.Duration, error\)](<#RetryConfig.GetRetryDelay>)
  - [func \(rc \*RetryConfig\) Validate\(\) error](<#RetryConfig.Validate>)
- [type YAMLOutput](<#YAMLOutput>)
  - [func \(y YAMLOutput\) String\(\) string](<#YAMLOutput.String>)


<a name="Example"></a>
## func [Example](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L63>)

```go
func Example() string
```

Example shows what a YAML graph definition would look like.

<a name="FromYAML"></a>
## func [FromYAML](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L134>)

```go
func FromYAML(yamlStr string, target any) error
```

FromYAML parses YAML string into the target structure.

<a name="LLMNodeBuilder"></a>
## func [LLMNodeBuilder](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L261>)

```go
func LLMNodeBuilder(def *NodeDefinition) (pocket.Node, error)
```

LLMNodeBuilder creates an LLM node from a definition.

<a name="ToYAML"></a>
## func [ToYAML](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L125>)

```go
func ToYAML(data any) (string, error)
```

ToYAML converts any data to YAML string.

<a name="ValidatorNodeBuilder"></a>
## func [ValidatorNodeBuilder](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L276>)

```go
func ValidatorNodeBuilder(def *NodeDefinition) (pocket.Node, error)
```

ValidatorNodeBuilder creates a validator node.

<a name="YAMLNode"></a>
## func [YAMLNode](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L15>)

```go
func YAMLNode(name string, execFn pocket.ExecFunc) pocket.Node
```

YAMLNode creates a node that marshals its output to YAML format. If execFn is provided, it wraps the function to marshal its output as YAML. If execFn is nil, the node will marshal its input as YAML.

<a name="YAMLNodeWithLifecycle"></a>
## func [YAMLNodeWithLifecycle](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L55>)

```go
func YAMLNodeWithLifecycle(name string, prep pocket.PrepFunc, exec pocket.ExecFunc, post pocket.PostFunc) pocket.Node
```

YAMLNodeWithLifecycle creates a YAML node with full lifecycle support. The exec function's output will be marshaled to YAML.

<a name="Connection"></a>
## type [Connection](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L33-L37>)

Connection represents a connection between nodes.

```go
type Connection struct {
    From   string `yaml:"from"`
    To     string `yaml:"to"`
    Action string `yaml:"action,omitempty"`
}
```

<a name="GraphDefinition"></a>
## type [GraphDefinition](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L10-L18>)

GraphDefinition represents a complete graph defined in YAML.

```go
type GraphDefinition struct {
    Name        string                 `yaml:"name"`
    Description string                 `yaml:"description,omitempty"`
    Version     string                 `yaml:"version,omitempty"`
    Metadata    map[string]interface{} `yaml:"metadata,omitempty"`
    Nodes       []NodeDefinition       `yaml:"nodes"`
    Connections []Connection           `yaml:"connections,omitempty"`
    Start       string                 `yaml:"start"`
}
```

<a name="GraphDefinition.Validate"></a>
### func \(\*GraphDefinition\) [Validate](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L48>)

```go
func (gd *GraphDefinition) Validate() error
```

Validate checks if the graph definition is valid.

<a name="Loader"></a>
## type [Loader](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L31-L34>)

Loader loads graph definitions and creates executable graphs.

```go
type Loader struct {
    // contains filtered or unexported fields
}
```

<a name="NewLoader"></a>
### func [NewLoader](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L37>)

```go
func NewLoader() *Loader
```

NewLoader creates a new YAML graph loader.

<a name="Loader.LoadDefinition"></a>
### func \(\*Loader\) [LoadDefinition](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L80>)

```go
func (l *Loader) LoadDefinition(def *GraphDefinition, store pocket.Store) (*pocket.Graph, error)
```

LoadDefinition creates a graph from a parsed definition.

<a name="Loader.LoadFile"></a>
### func \(\*Loader\) [LoadFile](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L60>)

```go
func (l *Loader) LoadFile(filename string, store pocket.Store) (*pocket.Graph, error)
```

LoadFile loads a graph from a YAML file.

<a name="Loader.LoadString"></a>
### func \(\*Loader\) [LoadString](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L70>)

```go
func (l *Loader) LoadString(yamlStr string, store pocket.Store) (*pocket.Graph, error)
```

LoadString loads a graph from a YAML string.

<a name="Loader.RegisterNodeType"></a>
### func \(\*Loader\) [RegisterNodeType](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L53>)

```go
func (l *Loader) RegisterNodeType(nodeType string, builder NodeBuilder)
```

RegisterNodeType registers a builder for a node type.

<a name="Loader.WithNodeFactory"></a>
### func \(\*Loader\) [WithNodeFactory](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L47>)

```go
func (l *Loader) WithNodeFactory(factory NodeFactory) *Loader
```

WithNodeFactory sets a custom node factory.

<a name="NodeBuilder"></a>
## type [NodeBuilder](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L28>)

NodeBuilder is a function that builds a node from a definition.

```go
type NodeBuilder func(def *NodeDefinition) (pocket.Node, error)
```

<a name="NodeDefinition"></a>
## type [NodeDefinition](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L21-L30>)

NodeDefinition represents a node in YAML format.

```go
type NodeDefinition struct {
    Name        string                 `yaml:"name"`
    Type        string                 `yaml:"type"`
    Description string                 `yaml:"description,omitempty"`
    Config      map[string]interface{} `yaml:"config,omitempty"`
    Retry       *RetryConfig           `yaml:"retry,omitempty"`
    Timeout     string                 `yaml:"timeout,omitempty"`
    InputType   string                 `yaml:"input_type,omitempty"`
    OutputType  string                 `yaml:"output_type,omitempty"`
}
```

<a name="NodeDefinition.GetTimeout"></a>
### func \(\*NodeDefinition\) [GetTimeout](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L141>)

```go
func (nd *NodeDefinition) GetTimeout() (time.Duration, error)
```

GetTimeout returns the parsed timeout duration.

<a name="NodeDefinition.Validate"></a>
### func \(\*NodeDefinition\) [Validate](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L96>)

```go
func (nd *NodeDefinition) Validate() error
```

Validate checks if the node definition is valid.

<a name="NodeFactory"></a>
## type [NodeFactory](<https://github.com/agentstation/pocket/blob/master/yaml/loader.go#L18-L20>)

NodeFactory creates nodes from definitions.

```go
type NodeFactory interface {
    CreateNode(def *NodeDefinition) (pocket.Node, error)
}
```

<a name="Parser"></a>
## type [Parser](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L11-L13>)

Parser handles parsing YAML graph definitions.

```go
type Parser struct {
}
```

<a name="NewParser"></a>
### func [NewParser](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L16>)

```go
func NewParser() *Parser
```

NewParser creates a new YAML parser.

<a name="Parser.Marshal"></a>
### func \(\*Parser\) [Marshal](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L47>)

```go
func (p *Parser) Marshal(gd *GraphDefinition) ([]byte, error)
```

Marshal converts a graph definition to YAML format.

<a name="Parser.MarshalToFile"></a>
### func \(\*Parser\) [MarshalToFile](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L53>)

```go
func (p *Parser) MarshalToFile(gd *GraphDefinition, filename string) error
```

MarshalToFile writes a graph definition to a YAML file.

<a name="Parser.Parse"></a>
### func \(\*Parser\) [Parse](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L21>)

```go
func (p *Parser) Parse(r io.Reader) (*GraphDefinition, error)
```

Parse reads and parses a YAML graph definition from a reader.

<a name="Parser.ParseFile"></a>
### func \(\*Parser\) [ParseFile](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L29>)

```go
func (p *Parser) ParseFile(filename string) (*GraphDefinition, error)
```

ParseFile reads and parses a YAML graph definition from a file.

<a name="Parser.ParseString"></a>
### func \(\*Parser\) [ParseString](<https://github.com/agentstation/pocket/blob/master/yaml/parser.go#L42>)

```go
func (p *Parser) ParseString(s string) (*GraphDefinition, error)
```

ParseString parses a YAML graph definition from a string.

<a name="RetryConfig"></a>
## type [RetryConfig](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L40-L45>)

RetryConfig represents retry configuration in YAML.

```go
type RetryConfig struct {
    MaxAttempts int     `yaml:"max_attempts"`
    Delay       string  `yaml:"delay"`
    Multiplier  float64 `yaml:"multiplier,omitempty"`
    MaxDelay    string  `yaml:"max_delay,omitempty"`
}
```

<a name="RetryConfig.GetMaxDelay"></a>
### func \(\*RetryConfig\) [GetMaxDelay](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L154>)

```go
func (rc *RetryConfig) GetMaxDelay() (time.Duration, error)
```

GetMaxDelay returns the parsed max delay duration.

<a name="RetryConfig.GetRetryDelay"></a>
### func \(\*RetryConfig\) [GetRetryDelay](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L149>)

```go
func (rc *RetryConfig) GetRetryDelay() (time.Duration, error)
```

GetRetryDelay returns the parsed retry delay duration.

<a name="RetryConfig.Validate"></a>
### func \(\*RetryConfig\) [Validate](<https://github.com/agentstation/pocket/blob/master/yaml/schema.go#L115>)

```go
func (rc *RetryConfig) Validate() error
```

Validate checks if the retry config is valid.

<a name="YAMLOutput"></a>
## type [YAMLOutput](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L113-L117>)

YAMLOutput represents structured output in YAML format.

```go
type YAMLOutput struct {
    YAML   string
    Data   any
    Format string
}
```

<a name="YAMLOutput.String"></a>
### func \(YAMLOutput\) [String](<https://github.com/agentstation/pocket/blob/master/yaml/output.go#L120>)

```go
func (y YAMLOutput) String() string
```

String returns the YAML representation.

# pocket

```go
import "github.com/agentstation/pocket/cmd/pocket"
```

## Index

- [func Execute\(\)](<#Execute>)
- [type DocsConfig](<#DocsConfig>)
- [type NodesConfig](<#NodesConfig>)
- [type RunConfig](<#RunConfig>)


<a name="Execute"></a>
## func [Execute](<https://github.com/agentstation/pocket/blob/master/cmd/pocket/main.go#L21>)

```go
func Execute()
```

Execute runs the root command.

<a name="DocsConfig"></a>
## type [DocsConfig](<https://github.com/agentstation/pocket/blob/master/cmd/pocket/docs.go#L35-L39>)

DocsConfig holds configuration for the docs command.

```go
type DocsConfig struct {
    Format   string // "markdown", "json"
    Output   string // Output file path (empty for stdout)
    Category string // Filter by category
}
```

<a name="NodesConfig"></a>
## type [NodesConfig](<https://github.com/agentstation/pocket/blob/master/cmd/pocket/nodes.go#L80-L83>)

NodesConfig holds configuration for the nodes command.

```go
type NodesConfig struct {
    Format string // "table", "json", "yaml"
    Type   string // Filter by specific node type
}
```

<a name="RunConfig"></a>
## type [RunConfig](<https://github.com/agentstation/pocket/blob/master/cmd/pocket/run.go#L28-L35>)

RunConfig holds configuration for the run command.

```go
type RunConfig struct {
    FilePath   string
    Verbose    bool
    DryRun     bool
    StoreType  string
    MaxEntries int
    TTL        time.Duration
}
```

# advanced

```go
import "github.com/agentstation/pocket/examples/advanced"
```

Package main demonstrates advanced Pocket features including graph composition, YAML support, fallback mechanisms, circuit breakers, and memory management.

## Index

- [type LLMRequest](<#LLMRequest>)
- [type LLMResponse](<#LLMResponse>)


<a name="LLMRequest"></a>
## type [LLMRequest](<https://github.com/agentstation/pocket/blob/master/examples/advanced/main.go#L23-L28>)

LLMRequest represents a request to an LLM service.

```go
type LLMRequest struct {
    Prompt      string  `yaml:"prompt"`
    MaxTokens   int     `yaml:"max_tokens"`
    Temperature float64 `yaml:"temperature"`
    Model       string  `yaml:"model"`
}
```

<a name="LLMResponse"></a>
## type [LLMResponse](<https://github.com/agentstation/pocket/blob/master/examples/advanced/main.go#L31-L36>)

LLMResponse represents a response from an LLM service.

```go
type LLMResponse struct {
    Text       string    `yaml:"text"`
    Model      string    `yaml:"model"`
    TokensUsed int       `yaml:"tokens_used"`
    Timestamp  time.Time `yaml:"timestamp"`
}
```

# agent

```go
import "github.com/agentstation/pocket/examples/agent"
```

Package main demonstrates an autonomous agent with a think\-act loop pattern using Pocket's Prep/Exec/Post lifecycle. The agent cycles through thinking, researching, and drafting phases to produce a final report.

## Index

- [type Task](<#Task>)


<a name="Task"></a>
## type [Task](<https://github.com/agentstation/pocket/blob/master/examples/agent/main.go#L21-L24>)

Task represents a task for the agent.

```go
type Task struct {
    Description string
    Steps       []string
}
```

# chat

```go
import "github.com/agentstation/pocket/examples/chat"
```

Package main demonstrates a multi\-agent chat system with intelligent routing between different specialized agents \(assistant, expert, creative\) based on the type of user query using the Prep/Exec/Post lifecycle.

## Index



# flow\-composition

```go
import "github.com/agentstation/pocket/examples/flow-composition"
```

Package main demonstrates graph\-as\-node composition where entire workflows can be treated as single nodes within larger workflows, enabling modular and reusable workflow design with the Prep/Exec/Post lifecycle.

## Index



# parallel

```go
import "github.com/agentstation/pocket/examples/parallel"
```

Package main demonstrates parallel document processing using Pocket's concurrency patterns and the Prep/Exec/Post lifecycle for efficient batch processing with FanOut and Pipeline patterns.

## Index

- [type Document](<#Document>)
- [type ProcessedDoc](<#ProcessedDoc>)


<a name="Document"></a>
## type [Document](<https://github.com/agentstation/pocket/blob/master/examples/parallel/main.go#L19-L23>)

Document represents a document to process.

```go
type Document struct {
    ID      int
    Title   string
    Content string
}
```

<a name="ProcessedDoc"></a>
## type [ProcessedDoc](<https://github.com/agentstation/pocket/blob/master/examples/parallel/main.go#L26-L32>)

ProcessedDoc represents the result of processing.

```go
type ProcessedDoc struct {
    ID       int
    Title    string
    Summary  string
    Keywords []string
    Duration time.Duration
}
```

# rag

```go
import "github.com/agentstation/pocket/examples/rag"
```

Package main demonstrates a Retrieval\-Augmented Generation \(RAG\) pattern using Pocket's Prep/Exec/Post lifecycle. This example shows how to build a document processing pipeline where Prep validates queries, Exec performs retrieval/augmentation/generation, and Post handles caching and routing.

## Index

- [type AugmentedQuery](<#AugmentedQuery>)
- [type Document](<#Document>)
- [type GeneratedResponse](<#GeneratedResponse>)
- [type Query](<#Query>)
- [type RetrievedContext](<#RetrievedContext>)


<a name="AugmentedQuery"></a>
## type [AugmentedQuery](<https://github.com/agentstation/pocket/blob/master/examples/rag/main.go#L39-L43>)

AugmentedQuery contains the original query enhanced with context.

```go
type AugmentedQuery struct {
    Original Query
    Context  RetrievedContext
    Prompt   string
}
```

<a name="Document"></a>
## type [Document](<https://github.com/agentstation/pocket/blob/master/examples/rag/main.go#L17-L22>)

Document represents a knowledge base document.

```go
type Document struct {
    ID      string
    Title   string
    Content string
    Tags    []string
}
```

<a name="GeneratedResponse"></a>
## type [GeneratedResponse](<https://github.com/agentstation/pocket/blob/master/examples/rag/main.go#L46-L50>)

GeneratedResponse is the final RAG output.

```go
type GeneratedResponse struct {
    Answer     string
    Sources    []string
    Confidence float64
}
```

<a name="Query"></a>
## type [Query](<https://github.com/agentstation/pocket/blob/master/examples/rag/main.go#L25-L29>)

Query represents a user query with metadata.

```go
type Query struct {
    Text    string
    UserID  string
    Context []string
}
```

<a name="RetrievedContext"></a>
## type [RetrievedContext](<https://github.com/agentstation/pocket/blob/master/examples/rag/main.go#L32-L36>)

RetrievedContext contains documents relevant to a query.

```go
type RetrievedContext struct {
    Query     Query
    Documents []Document
    Relevance map[string]float64
}
```

# saga

```go
import "github.com/agentstation/pocket/examples/saga"
```

Package main demonstrates the Saga pattern with Pocket using the Prep/Exec/Post lifecycle. This example shows how to implement distributed transactions with compensating actions for rollback, where Prep validates preconditions, Exec performs the transaction, and Post handles routing or compensation setup.

## Index

- [type Order](<#Order>)
- [type TransactionState](<#TransactionState>)


<a name="Order"></a>
## type [Order](<https://github.com/agentstation/pocket/blob/master/examples/saga/main.go#L19-L25>)

Order represents our domain object.

```go
type Order struct {
    ID         string
    CustomerID string
    Amount     float64
    Items      []string
    Status     string
}
```

<a name="TransactionState"></a>
## type [TransactionState](<https://github.com/agentstation/pocket/blob/master/examples/saga/main.go#L28-L32>)

TransactionState tracks saga progress.

```go
type TransactionState struct {
    CompletedSteps []string
    FailedStep     string
    RollbackMode   bool
}
```

# stateful

```go
import "github.com/agentstation/pocket/examples/stateful"
```

Package main demonstrates stateful workflow processing where nodes maintain and share state through Pocket's Store using the Prep/Exec/Post lifecycle, showing workflows that accumulate data across multiple stages.

## Index



# typed

```go
import "github.com/agentstation/pocket/examples/typed"
```

Package main demonstrates type\-safe workflow construction using the new Steps struct format with comprehensive type safety at compile\-time, init\-time, and runtime through the Prep/Exec/Post lifecycle pattern.

## Index

- [type EnrichmentResult](<#EnrichmentResult>)
- [type NotificationResult](<#NotificationResult>)
- [type User](<#User>)
- [type ValidationResult](<#ValidationResult>)


<a name="EnrichmentResult"></a>
## type [EnrichmentResult](<https://github.com/agentstation/pocket/blob/master/examples/typed/main.go#L29-L34>)



```go
type EnrichmentResult struct {
    User       User
    Department string
    Manager    string
    Role       string
}
```

<a name="NotificationResult"></a>
## type [NotificationResult](<https://github.com/agentstation/pocket/blob/master/examples/typed/main.go#L36-L40>)



```go
type NotificationResult struct {
    MessageID string
    Status    string
    Recipient string
}
```

<a name="User"></a>
## type [User](<https://github.com/agentstation/pocket/blob/master/examples/typed/main.go#L17-L21>)

Domain types for our workflow

```go
type User struct {
    ID    string
    Name  string
    Email string
}
```

<a name="ValidationResult"></a>
## type [ValidationResult](<https://github.com/agentstation/pocket/blob/master/examples/typed/main.go#L23-L27>)



```go
type ValidationResult struct {
    User   User
    Valid  bool
    Errors []string
}
```

# workflow

```go
import "github.com/agentstation/pocket/examples/workflow"
```

Package main demonstrates a complex multi\-stage workflow with the Prep/Exec/Post lifecycle pattern. This example shows how to build workflows where Prep validates preconditions, Exec performs business logic, and Post handles routing decisions and state updates.

## Index

- [type Item](<#Item>)
- [type ValidationResult](<#ValidationResult>)
- [type WorkflowData](<#WorkflowData>)


<a name="Item"></a>
## type [Item](<https://github.com/agentstation/pocket/blob/master/examples/workflow/main.go#L26-L30>)

Item represents a product in an order.

```go
type Item struct {
    SKU      string
    Quantity int
    Price    float64
}
```

<a name="ValidationResult"></a>
## type [ValidationResult](<https://github.com/agentstation/pocket/blob/master/examples/workflow/main.go#L33-L37>)

ValidationResult contains validation outcome and reasons.

```go
type ValidationResult struct {
    Data   WorkflowData
    Valid  bool
    Errors []string
}
```

<a name="WorkflowData"></a>
## type [WorkflowData](<https://github.com/agentstation/pocket/blob/master/examples/workflow/main.go#L17-L23>)

WorkflowData represents data flowing through the workflow.

```go
type WorkflowData struct {
    OrderID    string
    CustomerID string
    Items      []Item
    Status     string
    Timestamp  time.Time
}
```

# yaml

```go
import "github.com/agentstation/pocket/examples/yaml"
```

Package main demonstrates YAML support in Pocket, showing how YAML provides better token efficiency and readability compared to JSON when working with LLMs.

## Index

- [type JobDetail](<#JobDetail>)
- [type Resume](<#Resume>)


<a name="JobDetail"></a>
## type [JobDetail](<https://github.com/agentstation/pocket/blob/master/examples/yaml/main.go#L27-L31>)

JobDetail represents job experience.

```go
type JobDetail struct {
    Employer string `yaml:"employer" json:"employer"`
    Role     string `yaml:"role" json:"role"`
    Years    int    `yaml:"years" json:"years"`
}
```

<a name="Resume"></a>
## type [Resume](<https://github.com/agentstation/pocket/blob/master/examples/yaml/main.go#L19-L24>)

Resume represents a structured resume format.

```go
type Resume struct {
    Name       string      `yaml:"name" json:"name"`
    Email      string      `yaml:"email" json:"email"`
    Experience []JobDetail `yaml:"experience" json:"experience"`
    Skills     []string    `yaml:"skills" json:"skills"`
}
```

# graph

```go
import "github.com/agentstation/pocket/internal/graph"
```

Package graph provides advanced graph composition utilities.

## Index

- [func AsNodeWithStore\(graph \*pocket.Graph, name, inputKey, outputKey string\) pocket.Node](<#AsNodeWithStore>)
- [func ComposeGraphs\(name string, store pocket.Store, graphs ...\*pocket.Graph\) \(\*pocket.Graph, error\)](<#ComposeGraphs>)
- [func NewGraphNode\(name string, graph \*pocket.Graph, inputKey, outputKey string\) pocket.Node](<#NewGraphNode>)
- [func ParallelGraphs\(ctx context.Context, store pocket.Store, graphs ...\*pocket.Graph\) \(\[\]any, error\)](<#ParallelGraphs>)
- [type GraphNode](<#GraphNode>)
- [type NestedGraphBuilder](<#NestedGraphBuilder>)
  - [func NewNestedGraphBuilder\(name string, store pocket.Store\) \*NestedGraphBuilder](<#NewNestedGraphBuilder>)
  - [func \(b \*NestedGraphBuilder\) AddGraph\(name string, graph \*pocket.Graph\) \*NestedGraphBuilder](<#NestedGraphBuilder.AddGraph>)
  - [func \(b \*NestedGraphBuilder\) AddGraphWithStore\(name string, graph \*pocket.Graph, inputKey, outputKey string\) \*NestedGraphBuilder](<#NestedGraphBuilder.AddGraphWithStore>)
  - [func \(b \*NestedGraphBuilder\) Build\(\) \(\*pocket.Graph, error\)](<#NestedGraphBuilder.Build>)
  - [func \(b \*NestedGraphBuilder\) Connect\(from, action, to string\) \*NestedGraphBuilder](<#NestedGraphBuilder.Connect>)


<a name="AsNodeWithStore"></a>
## func [AsNodeWithStore](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L83>)

```go
func AsNodeWithStore(graph *pocket.Graph, name, inputKey, outputKey string) pocket.Node
```

AsNodeWithStore converts a Graph into a Node with specific store keys for input and output, enabling better state isolation.

<a name="ComposeGraphs"></a>
## func [ComposeGraphs](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L89>)

```go
func ComposeGraphs(name string, store pocket.Store, graphs ...*pocket.Graph) (*pocket.Graph, error)
```

ComposeGraphs creates a new graph that executes multiple graphs in sequence. Each graph is wrapped as a node and connected in order.

<a name="NewGraphNode"></a>
## func [NewGraphNode](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L25>)

```go
func NewGraphNode(name string, graph *pocket.Graph, inputKey, outputKey string) pocket.Node
```

NewGraphNode creates a new GraphNode that wraps the given graph. The inputKey and outputKey specify where in the store to read input and write output, enabling proper state isolation.

<a name="ParallelGraphs"></a>
## func [ParallelGraphs](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L112>)

```go
func ParallelGraphs(ctx context.Context, store pocket.Store, graphs ...*pocket.Graph) ([]any, error)
```

ParallelGraphs creates a graph that executes multiple graphs in parallel. Results are collected in a map keyed by graph index.

<a name="GraphNode"></a>
## type [GraphNode](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L14-L20>)

GraphNode wraps a Graph to make it usable as a Node within another Graph. This enables recursive composition where entire workflows can be treated as single nodes in larger workflows.

```go
type GraphNode struct {
    // contains filtered or unexported fields
}
```

<a name="NestedGraphBuilder"></a>
## type [NestedGraphBuilder](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L136-L143>)

NestedGraphBuilder provides a fluent API for building nested graph structures.

```go
type NestedGraphBuilder struct {
    // contains filtered or unexported fields
}
```

<a name="NewNestedGraphBuilder"></a>
### func [NewNestedGraphBuilder](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L146>)

```go
func NewNestedGraphBuilder(name string, store pocket.Store) *NestedGraphBuilder
```

NewNestedGraphBuilder creates a new builder for nested graphs.

<a name="NestedGraphBuilder.AddGraph"></a>
### func \(\*NestedGraphBuilder\) [AddGraph](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L155>)

```go
func (b *NestedGraphBuilder) AddGraph(name string, graph *pocket.Graph) *NestedGraphBuilder
```

AddGraph adds a graph as a node in the nested structure.

<a name="NestedGraphBuilder.AddGraphWithStore"></a>
### func \(\*NestedGraphBuilder\) [AddGraphWithStore](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L166>)

```go
func (b *NestedGraphBuilder) AddGraphWithStore(name string, graph *pocket.Graph, inputKey, outputKey string) *NestedGraphBuilder
```

AddGraphWithStore adds a graph with specific store keys.

<a name="NestedGraphBuilder.Build"></a>
### func \(\*NestedGraphBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L206>)

```go
func (b *NestedGraphBuilder) Build() (*pocket.Graph, error)
```

Build creates the final nested graph.

<a name="NestedGraphBuilder.Connect"></a>
### func \(\*NestedGraphBuilder\) [Connect](<https://github.com/agentstation/pocket/blob/master/internal/graph/composite.go#L177>)

```go
func (b *NestedGraphBuilder) Connect(from, action, to string) *NestedGraphBuilder
```

Connect connects two graphs by name with a specific action.

# node

```go
import "github.com/agentstation/pocket/internal/node"
```

## Index

- [func RegisterCommonTypes\(registry \*Registry\)](<#RegisterCommonTypes>)
- [func WithHooks\(manager \*HookManager\) middleware.Middleware](<#WithHooks>)
- [type Builder](<#Builder>)
- [type ChainHook](<#ChainHook>)
  - [func NewChainHook\(name string, hooks ...Hook\) \*ChainHook](<#NewChainHook>)
  - [func \(h \*ChainHook\) Execute\(ctx context.Context, event \*Event\) error](<#ChainHook.Execute>)
  - [func \(h \*ChainHook\) Name\(\) string](<#ChainHook.Name>)
- [type ConditionalHook](<#ConditionalHook>)
  - [func NewConditionalHook\(condition func\(\*Event\) bool, wrapped Hook\) \*ConditionalHook](<#NewConditionalHook>)
  - [func \(h \*ConditionalHook\) Execute\(ctx context.Context, event \*Event\) error](<#ConditionalHook.Execute>)
  - [func \(h \*ConditionalHook\) Name\(\) string](<#ConditionalHook.Name>)
- [type ConfigField](<#ConfigField>)
- [type Event](<#Event>)
- [type EventType](<#EventType>)
- [type Factory](<#Factory>)
  - [func NewFactory\(registry \*Registry\) \*Factory](<#NewFactory>)
  - [func \(f \*Factory\) Create\(nodeType string, config map\[string\]any\) \(pocket.Node, error\)](<#Factory.Create>)
  - [func \(f \*Factory\) SetDefaults\(nodeType string, defaults map\[string\]any\)](<#Factory.SetDefaults>)
- [type Hook](<#Hook>)
- [type HookManager](<#HookManager>)
  - [func NewHookManager\(\) \*HookManager](<#NewHookManager>)
  - [func \(m \*HookManager\) Register\(hook Hook, events ...EventType\)](<#HookManager.Register>)
  - [func \(m \*HookManager\) Trigger\(ctx context.Context, event \*Event\) error](<#HookManager.Trigger>)
- [type LoggingHook](<#LoggingHook>)
  - [func NewLoggingHook\(logger pocket.Logger\) \*LoggingHook](<#NewLoggingHook>)
  - [func \(h \*LoggingHook\) Execute\(ctx context.Context, event \*Event\) error](<#LoggingHook.Execute>)
  - [func \(h \*LoggingHook\) Name\(\) string](<#LoggingHook.Name>)
- [type Metadata](<#Metadata>)
- [type MetricsHook](<#MetricsHook>)
  - [func NewMetricsHook\(collector middleware.MetricsCollector\) \*MetricsHook](<#NewMetricsHook>)
  - [func \(h \*MetricsHook\) Execute\(ctx context.Context, event \*Event\) error](<#MetricsHook.Execute>)
  - [func \(h \*MetricsHook\) Name\(\) string](<#MetricsHook.Name>)
- [type Registry](<#Registry>)
  - [func NewRegistry\(\) \*Registry](<#NewRegistry>)
  - [func \(r \*Registry\) Create\(nodeType string, config map\[string\]any\) \(pocket.Node, error\)](<#Registry.Create>)
  - [func \(r \*Registry\) GetMetadata\(nodeType string\) \(Metadata, bool\)](<#Registry.GetMetadata>)
  - [func \(r \*Registry\) List\(\) \[\]string](<#Registry.List>)
  - [func \(r \*Registry\) ListByTag\(tag string\) \[\]string](<#Registry.ListByTag>)
  - [func \(r \*Registry\) Register\(nodeType string, builder Builder, metadata \*Metadata\) error](<#Registry.Register>)
  - [func \(r \*Registry\) ValidateConnection\(fromType, toType string\) error](<#Registry.ValidateConnection>)
- [type StoreHook](<#StoreHook>)
  - [func NewStoreHook\(prefix string\) \*StoreHook](<#NewStoreHook>)
  - [func \(h \*StoreHook\) Execute\(ctx context.Context, event \*Event\) error](<#StoreHook.Execute>)
  - [func \(h \*StoreHook\) Name\(\) string](<#StoreHook.Name>)
- [type TracingHook](<#TracingHook>)
  - [func NewTracingHook\(tracer pocket.Tracer\) \*TracingHook](<#NewTracingHook>)
  - [func \(h \*TracingHook\) Execute\(ctx context.Context, event \*Event\) error](<#TracingHook.Execute>)
  - [func \(h \*TracingHook\) Name\(\) string](<#TracingHook.Name>)
- [type TypeValidator](<#TypeValidator>)


<a name="RegisterCommonTypes"></a>
## func [RegisterCommonTypes](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L253>)

```go
func RegisterCommonTypes(registry *Registry)
```

RegisterCommonTypes registers commonly used node types.

<a name="WithHooks"></a>
## func [WithHooks](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L98>)

```go
func WithHooks(manager *HookManager) middleware.Middleware
```

WithHooks adds hook support to a node.

<a name="Builder"></a>
## type [Builder](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L22>)

Builder creates nodes of a specific type.

```go
type Builder func(config map[string]any) (pocket.Node, error)
```

<a name="ChainHook"></a>
## type [ChainHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L415-L418>)

ChainHook executes multiple hooks in sequence.

```go
type ChainHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewChainHook"></a>
### func [NewChainHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L421>)

```go
func NewChainHook(name string, hooks ...Hook) *ChainHook
```

NewChainHook creates a hook that chains multiple hooks.

<a name="ChainHook.Execute"></a>
### func \(\*ChainHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L432>)

```go
func (h *ChainHook) Execute(ctx context.Context, event *Event) error
```



<a name="ChainHook.Name"></a>
### func \(\*ChainHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L428>)

```go
func (h *ChainHook) Name() string
```



<a name="ConditionalHook"></a>
## type [ConditionalHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L388-L392>)

ConditionalHook executes only when condition is met.

```go
type ConditionalHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewConditionalHook"></a>
### func [NewConditionalHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L395>)

```go
func NewConditionalHook(condition func(*Event) bool, wrapped Hook) *ConditionalHook
```

NewConditionalHook creates a conditional hook.

<a name="ConditionalHook.Execute"></a>
### func \(\*ConditionalHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L407>)

```go
func (h *ConditionalHook) Execute(ctx context.Context, event *Event) error
```



<a name="ConditionalHook.Name"></a>
### func \(\*ConditionalHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L403>)

```go
func (h *ConditionalHook) Name() string
```



<a name="ConfigField"></a>
## type [ConfigField](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L36-L43>)

ConfigField describes a configuration field.

```go
type ConfigField struct {
    Name        string
    Type        string
    Required    bool
    Default     any
    Description string
    Validator   func(any) error
}
```

<a name="Event"></a>
## type [Event](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L20-L28>)

Event represents a lifecycle event.

```go
type Event struct {
    Type     EventType
    NodeName string
    Phase    string
    Input    any
    Output   any
    Error    error
    Metadata map[string]any
}
```

<a name="EventType"></a>
## type [EventType](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L31>)

EventType represents the type of lifecycle event.

```go
type EventType string
```

<a name="EventPrep"></a>

```go
const (
    EventPrep    EventType = "prep"
    EventExec    EventType = "exec"
    EventPost    EventType = "post"
    EventSuccess EventType = "success"
    EventError   EventType = "error"
    EventRoute   EventType = "route"
)
```

<a name="Factory"></a>
## type [Factory](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L378-L381>)

Factory provides convenient node creation.

```go
type Factory struct {
    // contains filtered or unexported fields
}
```

<a name="NewFactory"></a>
### func [NewFactory](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L384>)

```go
func NewFactory(registry *Registry) *Factory
```

NewFactory creates a new node factory.

<a name="Factory.Create"></a>
### func \(\*Factory\) [Create](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L397>)

```go
func (f *Factory) Create(nodeType string, config map[string]any) (pocket.Node, error)
```

Create creates a node with factory defaults applied.

<a name="Factory.SetDefaults"></a>
### func \(\*Factory\) [SetDefaults](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L392>)

```go
func (f *Factory) SetDefaults(nodeType string, defaults map[string]any)
```

SetDefaults sets default config for a node type.

<a name="Hook"></a>
## type [Hook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L14-L17>)

Hook represents a lifecycle hook.

```go
type Hook interface {
    Name() string
    Execute(ctx context.Context, event *Event) error
}
```

<a name="HookManager"></a>
## type [HookManager](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L43-L47>)

HookManager manages lifecycle hooks for nodes.

```go
type HookManager struct {
    // contains filtered or unexported fields
}
```

<a name="NewHookManager"></a>
### func [NewHookManager](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L50>)

```go
func NewHookManager() *HookManager
```

NewHookManager creates a new hook manager.

<a name="HookManager.Register"></a>
### func \(\*HookManager\) [Register](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L58>)

```go
func (m *HookManager) Register(hook Hook, events ...EventType)
```

Register registers a hook for specific event types.

<a name="HookManager.Trigger"></a>
### func \(\*HookManager\) [Trigger](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L74>)

```go
func (m *HookManager) Trigger(ctx context.Context, event *Event) error
```

Trigger executes hooks for an event.

<a name="LoggingHook"></a>
## type [LoggingHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L252-L255>)

LoggingHook logs lifecycle events.

```go
type LoggingHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewLoggingHook"></a>
### func [NewLoggingHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L258>)

```go
func NewLoggingHook(logger pocket.Logger) *LoggingHook
```

NewLoggingHook creates a logging hook.

<a name="LoggingHook.Execute"></a>
### func \(\*LoggingHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L269>)

```go
func (h *LoggingHook) Execute(ctx context.Context, event *Event) error
```



<a name="LoggingHook.Name"></a>
### func \(\*LoggingHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L265>)

```go
func (h *LoggingHook) Name() string
```



<a name="Metadata"></a>
## type [Metadata](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L25-L33>)

Metadata contains information about a node type.

```go
type Metadata struct {
    Name         string
    Description  string
    Version      string
    InputType    reflect.Type
    OutputType   reflect.Type
    ConfigSchema map[string]ConfigField
    Tags         []string
}
```

<a name="MetricsHook"></a>
## type [MetricsHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L287-L290>)

MetricsHook collects metrics from events.

```go
type MetricsHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewMetricsHook"></a>
### func [NewMetricsHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L293>)

```go
func NewMetricsHook(collector middleware.MetricsCollector) *MetricsHook
```

NewMetricsHook creates a metrics collection hook.

<a name="MetricsHook.Execute"></a>
### func \(\*MetricsHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L304>)

```go
func (h *MetricsHook) Execute(ctx context.Context, event *Event) error
```



<a name="MetricsHook.Name"></a>
### func \(\*MetricsHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L300>)

```go
func (h *MetricsHook) Name() string
```



<a name="Registry"></a>
## type [Registry](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L14-L19>)

Registry manages node type registration and creation.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="NewRegistry"></a>
### func [NewRegistry](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L51>)

```go
func NewRegistry() *Registry
```

NewRegistry creates a new node registry.

<a name="Registry.Create"></a>
### func \(\*Registry\) [Create](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L76>)

```go
func (r *Registry) Create(nodeType string, config map[string]any) (pocket.Node, error)
```

Create creates a node instance.

<a name="Registry.GetMetadata"></a>
### func \(\*Registry\) [GetMetadata](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L107>)

```go
func (r *Registry) GetMetadata(nodeType string) (Metadata, bool)
```

GetMetadata returns metadata for a node type.

<a name="Registry.List"></a>
### func \(\*Registry\) [List](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L116>)

```go
func (r *Registry) List() []string
```

List returns all registered node types.

<a name="Registry.ListByTag"></a>
### func \(\*Registry\) [ListByTag](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L128>)

```go
func (r *Registry) ListByTag(tag string) []string
```

ListByTag returns node types with a specific tag.

<a name="Registry.Register"></a>
### func \(\*Registry\) [Register](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L60>)

```go
func (r *Registry) Register(nodeType string, builder Builder, metadata *Metadata) error
```

Register registers a node type.

<a name="Registry.ValidateConnection"></a>
### func \(\*Registry\) [ValidateConnection](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L145>)

```go
func (r *Registry) ValidateConnection(fromType, toType string) error
```

ValidateConnection validates that two node types can be connected.

<a name="StoreHook"></a>
## type [StoreHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L364-L367>)

StoreHook stores event data in the store.

```go
type StoreHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewStoreHook"></a>
### func [NewStoreHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L370>)

```go
func NewStoreHook(prefix string) *StoreHook
```

NewStoreHook creates a hook that stores events.

<a name="StoreHook.Execute"></a>
### func \(\*StoreHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L381>)

```go
func (h *StoreHook) Execute(ctx context.Context, event *Event) error
```



<a name="StoreHook.Name"></a>
### func \(\*StoreHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L377>)

```go
func (h *StoreHook) Name() string
```



<a name="TracingHook"></a>
## type [TracingHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L321-L326>)

TracingHook adds distributed tracing.

```go
type TracingHook struct {
    // contains filtered or unexported fields
}
```

<a name="NewTracingHook"></a>
### func [NewTracingHook](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L329>)

```go
func NewTracingHook(tracer pocket.Tracer) *TracingHook
```

NewTracingHook creates a tracing hook.

<a name="TracingHook.Execute"></a>
### func \(\*TracingHook\) [Execute](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L341>)

```go
func (h *TracingHook) Execute(ctx context.Context, event *Event) error
```



<a name="TracingHook.Name"></a>
### func \(\*TracingHook\) [Name](<https://github.com/agentstation/pocket/blob/master/internal/node/hooks.go#L337>)

```go
func (h *TracingHook) Name() string
```



<a name="TypeValidator"></a>
## type [TypeValidator](<https://github.com/agentstation/pocket/blob/master/internal/node/registry.go#L46-L48>)

TypeValidator validates node type compatibility.

```go
type TypeValidator interface {
    ValidateConnection(from, to *Metadata) error
}
```

# script

```go
import "github.com/agentstation/pocket/nodes/script"
```

## Index

- [func ExecuteLuaScript\(ctx context.Context, scriptContent string, input any, verbose bool\) \(any, error\)](<#ExecuteLuaScript>)
- [type Manager](<#Manager>)
  - [func NewManager\(scriptsDir string, verbose bool\) \*Manager](<#NewManager>)
  - [func \(m \*Manager\) CreateNode\(script \*Script\) \(pocket.Node, error\)](<#Manager.CreateNode>)
  - [func \(m \*Manager\) Discover\(\) error](<#Manager.Discover>)
  - [func \(m \*Manager\) GetScript\(name string\) \(\*Script, bool\)](<#Manager.GetScript>)
  - [func \(m \*Manager\) ListScripts\(\) \[\]\*Script](<#Manager.ListScripts>)
  - [func \(m \*Manager\) LoadScript\(path string\) \(\*Script, error\)](<#Manager.LoadScript>)
  - [func \(m \*Manager\) ValidateScript\(path string\) error](<#Manager.ValidateScript>)
- [type Script](<#Script>)


<a name="ExecuteLuaScript"></a>
## func [ExecuteLuaScript](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L198>)

```go
func ExecuteLuaScript(ctx context.Context, scriptContent string, input any, verbose bool) (any, error)
```

ExecuteLuaScript executes a Lua script with the given input.

<a name="Manager"></a>
## type [Manager](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L17-L21>)

Manager handles script discovery and management.

```go
type Manager struct {
    // contains filtered or unexported fields
}
```

<a name="NewManager"></a>
### func [NewManager](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L34>)

```go
func NewManager(scriptsDir string, verbose bool) *Manager
```

NewManager creates a new script manager.

<a name="Manager.CreateNode"></a>
### func \(\*Manager\) [CreateNode](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L187>)

```go
func (m *Manager) CreateNode(script *Script) (pocket.Node, error)
```

CreateNode creates a Pocket node from a script.

<a name="Manager.Discover"></a>
### func \(\*Manager\) [Discover](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L47>)

```go
func (m *Manager) Discover() error
```

Discover finds all Lua scripts in the scripts directory.

<a name="Manager.GetScript"></a>
### func \(\*Manager\) [GetScript](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L135>)

```go
func (m *Manager) GetScript(name string) (*Script, bool)
```

GetScript returns a discovered script by name.

<a name="Manager.ListScripts"></a>
### func \(\*Manager\) [ListScripts](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L141>)

```go
func (m *Manager) ListScripts() []*Script
```

ListScripts returns all discovered scripts.

<a name="Manager.LoadScript"></a>
### func \(\*Manager\) [LoadScript](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L85>)

```go
func (m *Manager) LoadScript(path string) (*Script, error)
```

LoadScript loads and parses a Lua script.

<a name="Manager.ValidateScript"></a>
### func \(\*Manager\) [ValidateScript](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L150>)

```go
func (m *Manager) ValidateScript(path string) error
```

ValidateScript validates a Lua script without executing it.

<a name="Script"></a>
## type [Script](<https://github.com/agentstation/pocket/blob/master/nodes/script/manager.go#L24-L31>)

Script represents a discovered Lua script.

```go
type Script struct {
    Name        string
    Path        string
    Category    string
    Description string
    Version     string
    Content     string
}
```

# loader

```go
import "github.com/agentstation/pocket/plugins/loader"
```

Package loader provides plugin discovery and loading functionality.

## Index

- [func DefaultPluginPaths\(\) \[\]string](<#DefaultPluginPaths>)
- [func New\(\) plugins.Loader](<#New>)


<a name="DefaultPluginPaths"></a>
## func [DefaultPluginPaths](<https://github.com/agentstation/pocket/blob/master/plugins/loader/loader.go#L18>)

```go
func DefaultPluginPaths() []string
```

DefaultPluginPaths returns the default paths to search for plugins.

<a name="New"></a>
## func [New](<https://github.com/agentstation/pocket/blob/master/plugins/loader/loader.go#L39>)

```go
func New() plugins.Loader
```

New creates a new plugin loader.

# wasm

```go
import "github.com/agentstation/pocket/plugins/wasm"
```

Package wasm implements WebAssembly plugin support using wazero.

## Index

- [func LoadPlugin\(ctx context.Context, path string\) \(plugins.Plugin, error\)](<#LoadPlugin>)
- [func NewPlugin\(ctx context.Context, wasmBytes \[\]byte, metadata \*plugins.Metadata\) \(plugins.Plugin, error\)](<#NewPlugin>)
- [type PluginNodeBuilder](<#PluginNodeBuilder>)
  - [func NewPluginNodeBuilder\(p plugins.Plugin, nodeType \*plugins.NodeDefinition\) \*PluginNodeBuilder](<#NewPluginNodeBuilder>)
  - [func \(b \*PluginNodeBuilder\) Build\(def \*yaml.NodeDefinition\) \(pocket.Node, error\)](<#PluginNodeBuilder.Build>)
  - [func \(b \*PluginNodeBuilder\) Metadata\(\) nodes.Metadata](<#PluginNodeBuilder.Metadata>)


<a name="LoadPlugin"></a>
## func [LoadPlugin](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/plugin.go#L219>)

```go
func LoadPlugin(ctx context.Context, path string) (plugins.Plugin, error)
```

LoadPlugin loads a WebAssembly plugin from a file.

<a name="NewPlugin"></a>
## func [NewPlugin](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/plugin.go#L34>)

```go
func NewPlugin(ctx context.Context, wasmBytes []byte, metadata *plugins.Metadata) (plugins.Plugin, error)
```

NewPlugin creates a new WebAssembly plugin from bytes.

<a name="PluginNodeBuilder"></a>
## type [PluginNodeBuilder](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/builder.go#L15-L18>)

PluginNodeBuilder creates Pocket nodes from WASM plugins.

```go
type PluginNodeBuilder struct {
    // contains filtered or unexported fields
}
```

<a name="NewPluginNodeBuilder"></a>
### func [NewPluginNodeBuilder](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/builder.go#L21>)

```go
func NewPluginNodeBuilder(p plugins.Plugin, nodeType *plugins.NodeDefinition) *PluginNodeBuilder
```

NewPluginNodeBuilder creates a new builder for a specific node type in a plugin.

<a name="PluginNodeBuilder.Build"></a>
### func \(\*PluginNodeBuilder\) [Build](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/builder.go#L42>)

```go
func (b *PluginNodeBuilder) Build(def *yaml.NodeDefinition) (pocket.Node, error)
```

Build creates a new node instance.

<a name="PluginNodeBuilder.Metadata"></a>
### func \(\*PluginNodeBuilder\) [Metadata](<https://github.com/agentstation/pocket/blob/master/plugins/wasm/builder.go#L29>)

```go
func (b *PluginNodeBuilder) Metadata() nodes.Metadata
```

Metadata returns the node metadata.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
