# Batch Package

The `batch` package provides utilities for batch processing in Pocket workflows. It implements common patterns like map-reduce, parallel processing, and batch operations with type safety through Go generics.

## Features

- **Type-safe batch operations** with Go generics
- **Configurable concurrency** control
- **Map-reduce pattern** implementation
- **Filter and transform** operations
- **Error aggregation** for batch failures

## Usage Example

```go
import "github.com/agentstation/pocket/batch"

// Map-reduce pattern
processor := batch.MapReduce(
    extractItems,    // func(ctx, store) ([]T, error)
    transformItem,   // func(ctx, T) (R, error)  
    aggregateResults,// func(ctx, []R) (any, error)
    batch.WithConcurrency(10),
)

// Process items in parallel
batch.ForEach(items, processItem,
    batch.WithConcurrency(5),
)

// Filter items based on predicate
filtered := batch.Filter(items, func(item Item) bool {
    return item.IsValid()
})
```

## Common Patterns

### Parallel Processing
Process multiple items concurrently with controlled parallelism:
```go
results, err := batch.Process(ctx, items, func(ctx context.Context, item Item) (Result, error) {
    return processItem(ctx, item)
}, batch.WithConcurrency(10))
```

### Batch Aggregation
Aggregate results from multiple sources:
```go
aggregated, err := batch.Aggregate(ctx, sources, func(results []Result) Summary {
    return summarize(results)
})
```

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# batch

```go
import "github.com/agentstation/pocket/batch"
```

Package batch provides generic batch processing capabilities for pocket workflows.

## Index

- [func Filter\[T any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), predicate func\(context.Context, T\) \(bool, error\), opts ...Option\) pocket.Node](<#Filter>)
- [func ForEach\[T any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), process func\(context.Context, T\) error, opts ...Option\) pocket.Node](<#ForEach>)
- [func MapReduce\[T, R any\]\(name string, extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), mapper func\(context.Context, T\) \(R, error\), reducer func\(context.Context, \[\]R\) \(any, error\), opts ...Option\) pocket.Node](<#MapReduce>)
- [type Option](<#Option>)
  - [func WithConcurrency\(n int\) Option](<#WithConcurrency>)
  - [func WithOrdered\(\) Option](<#WithOrdered>)
- [type Processor](<#Processor>)
  - [func NewProcessor\[T, R any\]\(extract func\(context.Context, pocket.StoreReader\) \(\[\]T, error\), transform func\(context.Context, T\) \(R, error\), reduce func\(context.Context, \[\]R\) \(any, error\), opts ...Option\) \*Processor\[T, R\]](<#NewProcessor>)
  - [func \(p \*Processor\[T, R\]\) ToNode\(name string\) pocket.Node](<#Processor[T, R].ToNode>)


<a name="Filter"></a>
## func [Filter](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L214-L219>)

```go
func Filter[T any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), predicate func(context.Context, T) (bool, error), opts ...Option) pocket.Node
```

Filter creates a batch processor that filters items.

<a name="ForEach"></a>
## func [ForEach](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L195-L200>)

```go
func ForEach[T any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), process func(context.Context, T) error, opts ...Option) pocket.Node
```

ForEach creates a batch processor that doesn't aggregate results.

<a name="MapReduce"></a>
## func [MapReduce](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L183-L189>)

```go
func MapReduce[T, R any](name string, extract func(context.Context, pocket.StoreReader) ([]T, error), mapper func(context.Context, T) (R, error), reducer func(context.Context, []R) (any, error), opts ...Option) pocket.Node
```

MapReduce creates a map\-reduce batch processor as a Node.

<a name="Option"></a>
## type [Option](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L30>)

Option configures a batch processor.

```go
type Option func(*options)
```

<a name="WithConcurrency"></a>
### func [WithConcurrency](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L38>)

```go
func WithConcurrency(n int) Option
```

WithConcurrency sets the maximum concurrent workers.

<a name="WithOrdered"></a>
### func [WithOrdered](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L45>)

```go
func WithOrdered() Option
```

WithOrdered ensures results maintain input order.

<a name="Processor"></a>
## type [Processor](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L14-L27>)

Processor processes a batch of items of type T.

```go
type Processor[T, R any] struct {
    // Extract retrieves items to process.
    Extract func(ctx context.Context, store pocket.StoreReader) ([]T, error)

    // Transform processes a single item.
    Transform func(ctx context.Context, item T) (R, error)

    // Reduce combines results into a final output.
    Reduce func(ctx context.Context, results []R) (any, error)
    // contains filtered or unexported fields
}
```

<a name="NewProcessor"></a>
### func [NewProcessor](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L52-L57>)

```go
func NewProcessor[T, R any](extract func(context.Context, pocket.StoreReader) ([]T, error), transform func(context.Context, T) (R, error), reduce func(context.Context, []R) (any, error), opts ...Option) *Processor[T, R]
```

NewProcessor creates a new batch processor.

<a name="Processor[T, R].ToNode"></a>
### func \(\*Processor\[T, R\]\) [ToNode](<https://github.com/agentstation/pocket/blob/master/batch/batch.go#L82>)

```go
func (p *Processor[T, R]) ToNode(name string) pocket.Node
```

ToNode converts the batch processor into a pocket Node.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->